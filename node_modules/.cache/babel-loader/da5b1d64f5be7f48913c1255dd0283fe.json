{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar util_1 = require(\"../util\");\nvar VBox = /** @class */function () {\n  function VBox(r1, r2, g1, g2, b1, b2, hist) {\n    this._volume = -1;\n    this._count = -1;\n    this.dimension = {\n      r1: r1,\n      r2: r2,\n      g1: g1,\n      g2: g2,\n      b1: b1,\n      b2: b2\n    };\n    this.hist = hist;\n  }\n  VBox.build = function (pixels, shouldIgnore) {\n    var hn = 1 << 3 * util_1.SIGBITS;\n    var hist = new Uint32Array(hn);\n    var rmax;\n    var rmin;\n    var gmax;\n    var gmin;\n    var bmax;\n    var bmin;\n    var r;\n    var g;\n    var b;\n    var a;\n    rmax = gmax = bmax = 0;\n    rmin = gmin = bmin = Number.MAX_VALUE;\n    var n = pixels.length / 4;\n    var i = 0;\n    while (i < n) {\n      var offset = i * 4;\n      i++;\n      r = pixels[offset + 0];\n      g = pixels[offset + 1];\n      b = pixels[offset + 2];\n      a = pixels[offset + 3];\n      // Ignored pixels' alpha is marked as 0 in filtering stage\n      if (a === 0) continue;\n      r = r >> util_1.RSHIFT;\n      g = g >> util_1.RSHIFT;\n      b = b >> util_1.RSHIFT;\n      var index = util_1.getColorIndex(r, g, b);\n      hist[index] += 1;\n      if (r > rmax) rmax = r;\n      if (r < rmin) rmin = r;\n      if (g > gmax) gmax = g;\n      if (g < gmin) gmin = g;\n      if (b > bmax) bmax = b;\n      if (b < bmin) bmin = b;\n    }\n    return new VBox(rmin, rmax, gmin, gmax, bmin, bmax, hist);\n  };\n  VBox.prototype.invalidate = function () {\n    this._volume = this._count = -1;\n    this._avg = null;\n  };\n  VBox.prototype.volume = function () {\n    if (this._volume < 0) {\n      var _a = this.dimension,\n        r1 = _a.r1,\n        r2 = _a.r2,\n        g1 = _a.g1,\n        g2 = _a.g2,\n        b1 = _a.b1,\n        b2 = _a.b2;\n      this._volume = (r2 - r1 + 1) * (g2 - g1 + 1) * (b2 - b1 + 1);\n    }\n    return this._volume;\n  };\n  VBox.prototype.count = function () {\n    if (this._count < 0) {\n      var hist = this.hist;\n      var _a = this.dimension,\n        r1 = _a.r1,\n        r2 = _a.r2,\n        g1 = _a.g1,\n        g2 = _a.g2,\n        b1 = _a.b1,\n        b2 = _a.b2;\n      var c = 0;\n      for (var r = r1; r <= r2; r++) {\n        for (var g = g1; g <= g2; g++) {\n          for (var b = b1; b <= b2; b++) {\n            var index = util_1.getColorIndex(r, g, b);\n            c += hist[index];\n          }\n        }\n      }\n      this._count = c;\n    }\n    return this._count;\n  };\n  VBox.prototype.clone = function () {\n    var hist = this.hist;\n    var _a = this.dimension,\n      r1 = _a.r1,\n      r2 = _a.r2,\n      g1 = _a.g1,\n      g2 = _a.g2,\n      b1 = _a.b1,\n      b2 = _a.b2;\n    return new VBox(r1, r2, g1, g2, b1, b2, hist);\n  };\n  VBox.prototype.avg = function () {\n    if (!this._avg) {\n      var hist = this.hist;\n      var _a = this.dimension,\n        r1 = _a.r1,\n        r2 = _a.r2,\n        g1 = _a.g1,\n        g2 = _a.g2,\n        b1 = _a.b1,\n        b2 = _a.b2;\n      var ntot = 0;\n      var mult = 1 << 8 - util_1.SIGBITS;\n      var rsum = void 0;\n      var gsum = void 0;\n      var bsum = void 0;\n      rsum = gsum = bsum = 0;\n      for (var r = r1; r <= r2; r++) {\n        for (var g = g1; g <= g2; g++) {\n          for (var b = b1; b <= b2; b++) {\n            var index = util_1.getColorIndex(r, g, b);\n            var h = hist[index];\n            ntot += h;\n            rsum += h * (r + 0.5) * mult;\n            gsum += h * (g + 0.5) * mult;\n            bsum += h * (b + 0.5) * mult;\n          }\n        }\n      }\n      if (ntot) {\n        this._avg = [~~(rsum / ntot), ~~(gsum / ntot), ~~(bsum / ntot)];\n      } else {\n        this._avg = [~~(mult * (r1 + r2 + 1) / 2), ~~(mult * (g1 + g2 + 1) / 2), ~~(mult * (b1 + b2 + 1) / 2)];\n      }\n    }\n    return this._avg;\n  };\n  VBox.prototype.contains = function (rgb) {\n    var r = rgb[0],\n      g = rgb[1],\n      b = rgb[2];\n    var _a = this.dimension,\n      r1 = _a.r1,\n      r2 = _a.r2,\n      g1 = _a.g1,\n      g2 = _a.g2,\n      b1 = _a.b1,\n      b2 = _a.b2;\n    r >>= util_1.RSHIFT;\n    g >>= util_1.RSHIFT;\n    b >>= util_1.RSHIFT;\n    return r >= r1 && r <= r2 && g >= g1 && g <= g2 && b >= b1 && b <= b2;\n  };\n  VBox.prototype.split = function () {\n    var hist = this.hist;\n    var _a = this.dimension,\n      r1 = _a.r1,\n      r2 = _a.r2,\n      g1 = _a.g1,\n      g2 = _a.g2,\n      b1 = _a.b1,\n      b2 = _a.b2;\n    var count = this.count();\n    if (!count) return [];\n    if (count === 1) return [this.clone()];\n    var rw = r2 - r1 + 1;\n    var gw = g2 - g1 + 1;\n    var bw = b2 - b1 + 1;\n    var maxw = Math.max(rw, gw, bw);\n    var accSum = null;\n    var sum;\n    var total;\n    sum = total = 0;\n    var maxd = null;\n    if (maxw === rw) {\n      maxd = 'r';\n      accSum = new Uint32Array(r2 + 1);\n      for (var r = r1; r <= r2; r++) {\n        sum = 0;\n        for (var g = g1; g <= g2; g++) {\n          for (var b = b1; b <= b2; b++) {\n            var index = util_1.getColorIndex(r, g, b);\n            sum += hist[index];\n          }\n        }\n        total += sum;\n        accSum[r] = total;\n      }\n    } else if (maxw === gw) {\n      maxd = 'g';\n      accSum = new Uint32Array(g2 + 1);\n      for (var g = g1; g <= g2; g++) {\n        sum = 0;\n        for (var r = r1; r <= r2; r++) {\n          for (var b = b1; b <= b2; b++) {\n            var index = util_1.getColorIndex(r, g, b);\n            sum += hist[index];\n          }\n        }\n        total += sum;\n        accSum[g] = total;\n      }\n    } else {\n      maxd = 'b';\n      accSum = new Uint32Array(b2 + 1);\n      for (var b = b1; b <= b2; b++) {\n        sum = 0;\n        for (var r = r1; r <= r2; r++) {\n          for (var g = g1; g <= g2; g++) {\n            var index = util_1.getColorIndex(r, g, b);\n            sum += hist[index];\n          }\n        }\n        total += sum;\n        accSum[b] = total;\n      }\n    }\n    var splitPoint = -1;\n    var reverseSum = new Uint32Array(accSum.length);\n    for (var i = 0; i < accSum.length; i++) {\n      var d = accSum[i];\n      if (splitPoint < 0 && d > total / 2) splitPoint = i;\n      reverseSum[i] = total - d;\n    }\n    var vbox = this;\n    function doCut(d) {\n      var dim1 = d + '1';\n      var dim2 = d + '2';\n      var d1 = vbox.dimension[dim1];\n      var d2 = vbox.dimension[dim2];\n      var vbox1 = vbox.clone();\n      var vbox2 = vbox.clone();\n      var left = splitPoint - d1;\n      var right = d2 - splitPoint;\n      if (left <= right) {\n        d2 = Math.min(d2 - 1, ~~(splitPoint + right / 2));\n        d2 = Math.max(0, d2);\n      } else {\n        d2 = Math.max(d1, ~~(splitPoint - 1 - left / 2));\n        d2 = Math.min(vbox.dimension[dim2], d2);\n      }\n      while (!accSum[d2]) d2++;\n      var c2 = reverseSum[d2];\n      while (!c2 && accSum[d2 - 1]) c2 = reverseSum[--d2];\n      vbox1.dimension[dim2] = d2;\n      vbox2.dimension[dim1] = d2 + 1;\n      return [vbox1, vbox2];\n    }\n    return doCut(maxd);\n  };\n  return VBox;\n}();\nexports.default = VBox;","map":{"version":3,"names":["util_1","require","VBox","r1","r2","g1","g2","b1","b2","hist","_volume","_count","dimension","build","pixels","shouldIgnore","hn","SIGBITS","Uint32Array","rmax","rmin","gmax","gmin","bmax","bmin","r","g","b","a","Number","MAX_VALUE","n","length","i","offset","RSHIFT","index","getColorIndex","prototype","invalidate","_avg","volume","_a","count","c","clone","avg","ntot","mult","rsum","gsum","bsum","h","contains","rgb","split","rw","gw","bw","maxw","Math","max","accSum","sum","total","maxd","splitPoint","reverseSum","d","vbox","doCut","dim1","dim2","d1","d2","vbox1","vbox2","left","right","min","c2"],"sources":["../../src/quantizer/vbox.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script"}