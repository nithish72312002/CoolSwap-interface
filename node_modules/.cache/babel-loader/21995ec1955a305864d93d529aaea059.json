{"ast":null,"code":"/** PURE_IMPORTS_START tslib,_Subscriber,_Observable,_OuterSubscriber,_util_subscribeToResult PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Subscriber } from '../Subscriber';\nimport { Observable } from '../Observable';\nimport { OuterSubscriber } from '../OuterSubscriber';\nimport { subscribeToResult } from '../util/subscribeToResult';\nexport function delayWhen(delayDurationSelector, subscriptionDelay) {\n  if (subscriptionDelay) {\n    return function (source) {\n      return new SubscriptionDelayObservable(source, subscriptionDelay).lift(new DelayWhenOperator(delayDurationSelector));\n    };\n  }\n  return function (source) {\n    return source.lift(new DelayWhenOperator(delayDurationSelector));\n  };\n}\nvar DelayWhenOperator = /*@__PURE__*/function () {\n  function DelayWhenOperator(delayDurationSelector) {\n    this.delayDurationSelector = delayDurationSelector;\n  }\n  DelayWhenOperator.prototype.call = function (subscriber, source) {\n    return source.subscribe(new DelayWhenSubscriber(subscriber, this.delayDurationSelector));\n  };\n  return DelayWhenOperator;\n}();\nvar DelayWhenSubscriber = /*@__PURE__*/function (_super) {\n  tslib_1.__extends(DelayWhenSubscriber, _super);\n  function DelayWhenSubscriber(destination, delayDurationSelector) {\n    var _this = _super.call(this, destination) || this;\n    _this.delayDurationSelector = delayDurationSelector;\n    _this.completed = false;\n    _this.delayNotifierSubscriptions = [];\n    _this.index = 0;\n    return _this;\n  }\n  DelayWhenSubscriber.prototype.notifyNext = function (outerValue, _innerValue, _outerIndex, _innerIndex, innerSub) {\n    this.destination.next(outerValue);\n    this.removeSubscription(innerSub);\n    this.tryComplete();\n  };\n  DelayWhenSubscriber.prototype.notifyError = function (error, innerSub) {\n    this._error(error);\n  };\n  DelayWhenSubscriber.prototype.notifyComplete = function (innerSub) {\n    var value = this.removeSubscription(innerSub);\n    if (value) {\n      this.destination.next(value);\n    }\n    this.tryComplete();\n  };\n  DelayWhenSubscriber.prototype._next = function (value) {\n    var index = this.index++;\n    try {\n      var delayNotifier = this.delayDurationSelector(value, index);\n      if (delayNotifier) {\n        this.tryDelay(delayNotifier, value);\n      }\n    } catch (err) {\n      this.destination.error(err);\n    }\n  };\n  DelayWhenSubscriber.prototype._complete = function () {\n    this.completed = true;\n    this.tryComplete();\n    this.unsubscribe();\n  };\n  DelayWhenSubscriber.prototype.removeSubscription = function (subscription) {\n    subscription.unsubscribe();\n    var subscriptionIdx = this.delayNotifierSubscriptions.indexOf(subscription);\n    if (subscriptionIdx !== -1) {\n      this.delayNotifierSubscriptions.splice(subscriptionIdx, 1);\n    }\n    return subscription.outerValue;\n  };\n  DelayWhenSubscriber.prototype.tryDelay = function (delayNotifier, value) {\n    var notifierSubscription = subscribeToResult(this, delayNotifier, value);\n    if (notifierSubscription && !notifierSubscription.closed) {\n      var destination = this.destination;\n      destination.add(notifierSubscription);\n      this.delayNotifierSubscriptions.push(notifierSubscription);\n    }\n  };\n  DelayWhenSubscriber.prototype.tryComplete = function () {\n    if (this.completed && this.delayNotifierSubscriptions.length === 0) {\n      this.destination.complete();\n    }\n  };\n  return DelayWhenSubscriber;\n}(OuterSubscriber);\nvar SubscriptionDelayObservable = /*@__PURE__*/function (_super) {\n  tslib_1.__extends(SubscriptionDelayObservable, _super);\n  function SubscriptionDelayObservable(source, subscriptionDelay) {\n    var _this = _super.call(this) || this;\n    _this.source = source;\n    _this.subscriptionDelay = subscriptionDelay;\n    return _this;\n  }\n  SubscriptionDelayObservable.prototype._subscribe = function (subscriber) {\n    this.subscriptionDelay.subscribe(new SubscriptionDelaySubscriber(subscriber, this.source));\n  };\n  return SubscriptionDelayObservable;\n}(Observable);\nvar SubscriptionDelaySubscriber = /*@__PURE__*/function (_super) {\n  tslib_1.__extends(SubscriptionDelaySubscriber, _super);\n  function SubscriptionDelaySubscriber(parent, source) {\n    var _this = _super.call(this) || this;\n    _this.parent = parent;\n    _this.source = source;\n    _this.sourceSubscribed = false;\n    return _this;\n  }\n  SubscriptionDelaySubscriber.prototype._next = function (unused) {\n    this.subscribeToSource();\n  };\n  SubscriptionDelaySubscriber.prototype._error = function (err) {\n    this.unsubscribe();\n    this.parent.error(err);\n  };\n  SubscriptionDelaySubscriber.prototype._complete = function () {\n    this.unsubscribe();\n    this.subscribeToSource();\n  };\n  SubscriptionDelaySubscriber.prototype.subscribeToSource = function () {\n    if (!this.sourceSubscribed) {\n      this.sourceSubscribed = true;\n      this.unsubscribe();\n      this.source.subscribe(this.parent);\n    }\n  };\n  return SubscriptionDelaySubscriber;\n}(Subscriber);","map":{"version":3,"names":["tslib_1","Subscriber","Observable","OuterSubscriber","subscribeToResult","delayWhen","delayDurationSelector","subscriptionDelay","source","SubscriptionDelayObservable","lift","DelayWhenOperator","prototype","call","subscriber","subscribe","DelayWhenSubscriber","_super","__extends","destination","_this","completed","delayNotifierSubscriptions","notifyNext","outerValue","_innerValue","_outerIndex","_innerIndex","innerSub","next","removeSubscription","tryComplete","notifyError","error","_error","notifyComplete","value","_next","index","delayNotifier","tryDelay","err","_complete","unsubscribe","subscription","subscriptionIdx","indexOf","splice","notifierSubscription","closed","add","push","length","complete","_subscribe","SubscriptionDelaySubscriber","parent","unused","subscribeToSource","sourceSubscribed"],"sources":["../../../src/internal/operators/delayWhen.ts"],"sourcesContent":[null],"mappings":";AACA,OAAO,KAAEA,OAAU,MAAE,OAAM;AAC3B,SAASC,UAAU,QAAQ,eAAe;AAE1C,SAASC,UAAA,QAAiB,eAAM;AAEhC,SAASC,eAAA,QAAmB,oBAAM;AAqElC,SAAMC,iBAAuB,mCACA;OAC3B,SAAIC,SAAiBA,CAAAC,qBAAE,EAAAC,iBAAA;MACrBA,iBAAQ;WACN,UAAIC,MAAA;aACD,IAAKC,2BAAsB,CAAAD,MAAA,EAAAD,iBAAuB,EAACG,IAAA,KAAAC,iBAAA,CAAAL,qBAAA;IACzD;EACD;EACD,iBAAAE,MAAA;IAAA,OAAAA,MAAA,CAAAE,IAAA,KAAAC,iBAAA,CAAAL,qBAAA;EAAA;AAED;IACEK,iBAAA,gBAAoB;WAAAA,kBAAAL,qBAAA;IACnB,KAAAA,qBAAA,GAAAA,qBAAA;EAED;mBACe,CAACM,SAAS,CAACC,IAAI,aAAAC,UAAoB,EAAAN,MAAU,EAAE;IAC7D,OAAAA,MAAA,CAAAO,SAAA,KAAAC,mBAAA,CAAAF,UAAA,OAAAR,qBAAA;EACH;EAPA,OAOCK,iBAAA;AAOD;IAAwCK,mBAAA,0BAAqBC,MAAA;EAK3DjB,OAAA,CAAAkB,SAAA,CAAAF,mBAAY,EAAAC,MACQ;WADpBD,mBAEEA,CAAAG,WAAM,EAAAb,qBACP;IAFmB,IAAAc,KAAA,GAAAH,MAAA,CAAAJ,IAAA,KAAqB,EAArBM,WAAA;IALZC,KAAA,CAAAd,qBAA2B,GAAAA,qBAAA;IAC3Bc,KAAA,CAAAC,SAAA;IACAD,KAAA,CAAAE,0BAAkB;;IAKzB,OAAAF,KAAA;EAED;qBAGO,CAAWR,SAAO,CAAAW,UAAY,aAAAC,UAAA,EAAAC,WAAA,EAAAC,WAAA,EAAAC,WAAA,EAAAC,QAAA;IACnC,IAAI,CAACT,WAAA,CAAAU,IAAA,CAAAL,UAA2B,CAAC;IACjC,IAAI,CAACM,kBAAc,CAAAF,QAAA;IACpB,KAAAG,WAAA;EAED;qBACc,CAAAnB,SAAO,CAAAoB,WAAA,aAAAC,KAAA,EAAAL,QAAA;IACpB,KAAAM,MAAA,CAAAD,KAAA;EAED;qBACgB,CAAIrB,SAAC,CAAAuB,cAAmB,aAAUP,QAAA;IAChD,IAAIQ,KAAK,GAAE,KAAAN,kBAAA,CAAAF,QAAA;QACTQ,KAAK;MACN,KAAAjB,WAAA,CAAAU,IAAA,CAAAO,KAAA;IACD;IACD,KAAAL,WAAA;EAES;qBACM,CAAInB,SAAS,CAAAyB,KAAA,aAAAD,KAAA;IAC3B,IAAIE,KAAA,QAAAA,KAAA;QACF;MACA,IAAIC,aAAa,GAAE,KAAAjC,qBAAA,CAAA8B,KAAA,EAAAE,KAAA;UACjBC,aAAa,EAAC;QACf,KAAAC,QAAA,CAAAD,aAAA,EAAAH,KAAA;MACF;IAAC,E,OACAK,GAAK;MACN,KAAAtB,WAAA,CAAAc,KAAA,CAAAQ,GAAA;IACF;EAES;qBACM,CAAA7B,SAAQ,CAAA8B,SAAA;IACtB,IAAI,CAACrB,SAAA,GAAW,IAAG;IACnB,IAAI,CAACU,WAAW,EAAE;IACnB,KAAAY,WAAA;EAEO;qBACO,CAAA/B,SAAW,CAAEkB,kBAAC,aAAAc,YAAA;IAE3BA,YAAM,CAAAD,WAAkB,EAAI;IAC5B,IAAIE,eAAe,OAAO,CAAAvB,0BAAE,CAAAwB,OAAA,CAAAF,YAAA;QAC1BC,eAAK;MACN,KAAAvB,0BAAA,CAAAyB,MAAA,CAAAF,eAAA;IAED;IACD,OAAAD,YAAA,CAAApB,UAAA;EAEO;qBACA,CAAAZ,SAAoB,CAAA4B,QAAG,aAAkBD,aAAM,EAAAH,KAAe;IAEpE,IAAIY,oBAAoB,GAAA5C,iBAAK,KAAoB,EAACmC,aAAQ,EAAAH,KAAA;QACxDY,oBAAoB,IAAK,CAAAA,oBAA4B,CAAAC,MAAA;MACrD,IAAA9B,WAAe,GAAC,KAAAA,WAAA;MAChBA,WAAK,CAAA+B,GAAA,CAAAF,oBAA+B,CAAC;MACtC,KAAA1B,0BAAA,CAAA6B,IAAA,CAAAH,oBAAA;IACF;EAEO;qBACG,CAAApC,SAAa,CAAImB,WAAC;QACzB,IAAI,CAACV,SAAA,IAAY,KAAAC,0BAAY,CAAA8B,MAAA;MAC9B,KAAAjC,WAAA,CAAAkC,QAAA;IACF;EACH;EA1EwC,OAAArC,mBA0EvC;AAOD,EAAAb,eAAA;IAA6CM,2BAAA,0BAAaQ,MAAA;EACxDjB,OAAA,CAAAkB,SAAA,CAAAT,2BAAkD,EAAAQ,MAAA;WAAlDR,2BACSA,CAAAD,MACR,EAAAD,iBAAA;IAFkB,IAAAa,KAAA,GAAMH,MAAN,CAAAJ,IAAqB;IAAUO,KAAA,CAAAZ,MAAA,GAAAA,MAAA;;IAEjD,OAAAY,KAAA;EAGD;6BACyB,CAAAR,SAAU,CAAA0C,UAAI,aAAAxC,UAA4B;IAClE,KAAAP,iBAAA,CAAAQ,SAAA,KAAAwC,2BAAA,CAAAzC,UAAA,OAAAN,MAAA;EACH;EAT6C,OAAAC,2BAS5C;AAOD,EAAAP,UAAA;IAA6CqD,2BAAA,0BAAatC,MAAA;EAGxDjB,OAAA,CAAAkB,SAAA,CAAAqC,2BAAmD,EAAAtC,MAAqB;WAAxEsC,2BACSA,CAAAC,MACR,EAAAhD,MAAA;IAFmB,IAAAY,KAAA,GAAMH,MAAN,CAAAJ,IAAqB;IAAUO,KAAA,CAAAoC,MAAM,GAANA,MAAM;IAFjDpC,KAAA,CAAAZ,MAAA,GAAAA,MAAA;;IAIP,OAAAY,KAAA;EAES;6BACc,CAAER,SAAC,CAAAyB,KAAA,aAAAoB,MAAA;IAC1B,KAAAC,iBAAA;EAES;6BACW,CAAA9C,SAAA,CAAAsB,MAAA,aAAAO,GAAA;IACnB,IAAI,CAACE,WAAO,CAAK,CAAC;IACnB,KAAAa,MAAA,CAAAvB,KAAA,CAAAQ,GAAA;EAES;6BACW,CAAA7B,SAAA,CAAA8B,SAAA;IACnB,IAAI,CAACC,WAAA;IACN,KAAAe,iBAAA;EAEO;6BACI,CAAA9C,SAAkB,CAAA8C,iBAAA;QAC1B,KAAK,CAAAC,gBAAgB,EAAG;MACxB,IAAI,CAACA,gBAAc;MACnB,IAAI,CAAChB,WAAO;MACb,KAAAnC,MAAA,CAAAO,SAAA,MAAAyC,MAAA;IACF;EACH;EA5B6C,OAAAD,2BA4B5C"},"metadata":{},"sourceType":"module"}