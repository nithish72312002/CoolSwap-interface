{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return _extendStatics(d, b);\n  };\n  return function (d, b) {\n    _extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar base_1 = require(\"./base\");\nvar Url = __importStar(require(\"url\"));\nfunction isRelativeUrl(url) {\n  var u = Url.parse(url);\n  return u.protocol === null && u.host === null && u.port === null;\n}\nfunction isSameOrigin(a, b) {\n  var ua = Url.parse(a);\n  var ub = Url.parse(b);\n  // https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\n  return ua.protocol === ub.protocol && ua.hostname === ub.hostname && ua.port === ub.port;\n}\nvar BrowserImage = /** @class */function (_super) {\n  __extends(BrowserImage, _super);\n  function BrowserImage() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  BrowserImage.prototype._initCanvas = function () {\n    var img = this.image;\n    var canvas = this._canvas = document.createElement('canvas');\n    var context = this._context = canvas.getContext('2d');\n    canvas.className = 'vibrant-canvas';\n    canvas.style.display = 'none';\n    this._width = canvas.width = img.width;\n    this._height = canvas.height = img.height;\n    context.drawImage(img, 0, 0);\n    document.body.appendChild(canvas);\n  };\n  BrowserImage.prototype.load = function (image) {\n    var _this = this;\n    var img = null;\n    var src = null;\n    if (typeof image === 'string') {\n      img = document.createElement('img');\n      if (!isRelativeUrl(image) && !isSameOrigin(window.location.href, image)) {\n        img.crossOrigin = 'anonymous';\n      }\n      src = img.src = image;\n    } else if (image instanceof HTMLImageElement) {\n      img = image;\n      src = image.src;\n    } else {\n      return Promise.reject(new Error(\"Cannot load buffer as an image in browser\"));\n    }\n    this.image = img;\n    return new Promise(function (resolve, reject) {\n      var onImageLoad = function onImageLoad() {\n        _this._initCanvas();\n        resolve(_this);\n      };\n      if (img.complete) {\n        // Already loaded\n        onImageLoad();\n      } else {\n        img.onload = onImageLoad;\n        img.onerror = function (e) {\n          return reject(new Error(\"Fail to load image: \" + src));\n        };\n      }\n    });\n  };\n  BrowserImage.prototype.clear = function () {\n    this._context.clearRect(0, 0, this._width, this._height);\n  };\n  BrowserImage.prototype.update = function (imageData) {\n    this._context.putImageData(imageData, 0, 0);\n  };\n  BrowserImage.prototype.getWidth = function () {\n    return this._width;\n  };\n  BrowserImage.prototype.getHeight = function () {\n    return this._height;\n  };\n  BrowserImage.prototype.resize = function (targetWidth, targetHeight, ratio) {\n    var _a = this,\n      canvas = _a._canvas,\n      context = _a._context,\n      img = _a.image;\n    this._width = canvas.width = targetWidth;\n    this._height = canvas.height = targetHeight;\n    context.scale(ratio, ratio);\n    context.drawImage(img, 0, 0);\n  };\n  BrowserImage.prototype.getPixelCount = function () {\n    return this._width * this._height;\n  };\n  BrowserImage.prototype.getImageData = function () {\n    return this._context.getImageData(0, 0, this._width, this._height);\n  };\n  BrowserImage.prototype.remove = function () {\n    if (this._canvas && this._canvas.parentNode) {\n      this._canvas.parentNode.removeChild(this._canvas);\n    }\n  };\n  return BrowserImage;\n}(base_1.ImageBase);\nexports.default = BrowserImage;","map":{"version":3,"names":["base_1","require","Url","__importStar","isRelativeUrl","url","u","parse","protocol","host","port","isSameOrigin","a","b","ua","ub","hostname","BrowserImage","_super","__extends","prototype","_initCanvas","img","image","canvas","_canvas","document","createElement","context","_context","getContext","className","style","display","_width","width","_height","height","drawImage","body","appendChild","load","_this","src","window","location","href","crossOrigin","HTMLImageElement","Promise","reject","Error","resolve","onImageLoad","complete","onload","onerror","e","clear","clearRect","update","imageData","putImageData","getWidth","getHeight","resize","targetWidth","targetHeight","ratio","_a","scale","getPixelCount","getImageData","remove","parentNode","removeChild","ImageBase"],"sources":["../../src/image/browser.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script"}