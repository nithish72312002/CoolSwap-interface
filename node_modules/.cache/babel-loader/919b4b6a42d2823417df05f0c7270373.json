{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.serializeError = exports.isValidCode = exports.getMessageFromCode = exports.JSON_RPC_SERVER_ERROR_MESSAGE = void 0;\nvar error_constants_1 = require(\"./error-constants\");\nvar classes_1 = require(\"./classes\");\nvar FALLBACK_ERROR_CODE = error_constants_1.errorCodes.rpc.internal;\nvar FALLBACK_MESSAGE = 'Unspecified error message. This is a bug, please report it.';\nvar FALLBACK_ERROR = {\n  code: FALLBACK_ERROR_CODE,\n  message: getMessageFromCode(FALLBACK_ERROR_CODE)\n};\nexports.JSON_RPC_SERVER_ERROR_MESSAGE = 'Unspecified server error.';\n/**\n * Gets the message for a given code, or a fallback message if the code has\n * no corresponding message.\n */\nfunction getMessageFromCode(code) {\n  var fallbackMessage = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : FALLBACK_MESSAGE;\n  if (Number.isInteger(code)) {\n    var codeString = code.toString();\n    if (hasKey(error_constants_1.errorValues, codeString)) {\n      return error_constants_1.errorValues[codeString].message;\n    }\n    if (isJsonRpcServerError(code)) {\n      return exports.JSON_RPC_SERVER_ERROR_MESSAGE;\n    }\n  }\n  return fallbackMessage;\n}\nexports.getMessageFromCode = getMessageFromCode;\n/**\n * Returns whether the given code is valid.\n * A code is only valid if it has a message.\n */\nfunction isValidCode(code) {\n  if (!Number.isInteger(code)) {\n    return false;\n  }\n  var codeString = code.toString();\n  if (error_constants_1.errorValues[codeString]) {\n    return true;\n  }\n  if (isJsonRpcServerError(code)) {\n    return true;\n  }\n  return false;\n}\nexports.isValidCode = isValidCode;\n/**\n * Serializes the given error to an Ethereum JSON RPC-compatible error object.\n * Merely copies the given error's values if it is already compatible.\n * If the given error is not fully compatible, it will be preserved on the\n * returned object's data.originalError property.\n */\nfunction serializeError(error) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n    _ref$fallbackError = _ref.fallbackError,\n    fallbackError = _ref$fallbackError === void 0 ? FALLBACK_ERROR : _ref$fallbackError,\n    _ref$shouldIncludeSta = _ref.shouldIncludeStack,\n    shouldIncludeStack = _ref$shouldIncludeSta === void 0 ? false : _ref$shouldIncludeSta;\n  var _a, _b;\n  if (!fallbackError || !Number.isInteger(fallbackError.code) || typeof fallbackError.message !== 'string') {\n    throw new Error('Must provide fallback error with integer number code and string message.');\n  }\n  if (error instanceof classes_1.EthereumRpcError) {\n    return error.serialize();\n  }\n  var serialized = {};\n  if (error && typeof error === 'object' && !Array.isArray(error) && hasKey(error, 'code') && isValidCode(error.code)) {\n    var _error = error;\n    serialized.code = _error.code;\n    if (_error.message && typeof _error.message === 'string') {\n      serialized.message = _error.message;\n      if (hasKey(_error, 'data')) {\n        serialized.data = _error.data;\n      }\n    } else {\n      serialized.message = getMessageFromCode(serialized.code);\n      serialized.data = {\n        originalError: assignOriginalError(error)\n      };\n    }\n  } else {\n    serialized.code = fallbackError.code;\n    var message = (_a = error) === null || _a === void 0 ? void 0 : _a.message;\n    serialized.message = message && typeof message === 'string' ? message : fallbackError.message;\n    serialized.data = {\n      originalError: assignOriginalError(error)\n    };\n  }\n  var stack = (_b = error) === null || _b === void 0 ? void 0 : _b.stack;\n  if (shouldIncludeStack && error && stack && typeof stack === 'string') {\n    serialized.stack = stack;\n  }\n  return serialized;\n}\nexports.serializeError = serializeError;\n// Internal\nfunction isJsonRpcServerError(code) {\n  return code >= -32099 && code <= -32000;\n}\nfunction assignOriginalError(error) {\n  if (error && typeof error === 'object' && !Array.isArray(error)) {\n    return Object.assign({}, error);\n  }\n  return error;\n}\nfunction hasKey(obj, key) {\n  return Object.prototype.hasOwnProperty.call(obj, key);\n}","map":{"version":3,"names":["error_constants_1","require","classes_1","FALLBACK_ERROR_CODE","errorCodes","rpc","internal","FALLBACK_MESSAGE","FALLBACK_ERROR","code","message","getMessageFromCode","exports","JSON_RPC_SERVER_ERROR_MESSAGE","fallbackMessage","arguments","length","undefined","Number","isInteger","codeString","toString","hasKey","errorValues","isJsonRpcServerError","isValidCode","serializeError","error","_ref","_ref$fallbackError","fallbackError","_ref$shouldIncludeSta","shouldIncludeStack","Error","EthereumRpcError","serialize","serialized","Array","isArray","_error","data","originalError","assignOriginalError","_a","stack","_b","Object","assign","obj","key","prototype","hasOwnProperty","call"],"sources":["../src/utils.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script"}