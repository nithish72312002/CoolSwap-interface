{"ast":null,"code":"\"use strict\";\n\nimport { getAddress } from \"@ethersproject/address\";\nimport { BigNumber } from \"@ethersproject/bignumber\";\nimport { arrayify, hexConcat, hexDataLength, hexDataSlice, hexlify, hexZeroPad, isBytesLike, splitSignature, stripZeros } from \"@ethersproject/bytes\";\nimport { Zero } from \"@ethersproject/constants\";\nimport { keccak256 } from \"@ethersproject/keccak256\";\nimport { checkProperties } from \"@ethersproject/properties\";\nimport * as RLP from \"@ethersproject/rlp\";\nimport { computePublicKey, recoverPublicKey } from \"@ethersproject/signing-key\";\nimport { Logger } from \"@ethersproject/logger\";\nimport { version } from \"./_version\";\nvar logger = new Logger(version);\n///////////////////////////////\nfunction handleAddress(value) {\n  if (value === \"0x\") {\n    return null;\n  }\n  return getAddress(value);\n}\nfunction handleNumber(value) {\n  if (value === \"0x\") {\n    return Zero;\n  }\n  return BigNumber.from(value);\n}\n// Legacy Transaction Fields\nvar transactionFields = [{\n  name: \"nonce\",\n  maxLength: 32,\n  numeric: true\n}, {\n  name: \"gasPrice\",\n  maxLength: 32,\n  numeric: true\n}, {\n  name: \"gasLimit\",\n  maxLength: 32,\n  numeric: true\n}, {\n  name: \"to\",\n  length: 20\n}, {\n  name: \"value\",\n  maxLength: 32,\n  numeric: true\n}, {\n  name: \"data\"\n}];\nvar allowedTransactionKeys = {\n  chainId: true,\n  data: true,\n  gasLimit: true,\n  gasPrice: true,\n  nonce: true,\n  to: true,\n  value: true\n};\nexport function computeAddress(key) {\n  var publicKey = computePublicKey(key);\n  return getAddress(hexDataSlice(keccak256(hexDataSlice(publicKey, 1)), 12));\n}\nexport function recoverAddress(digest, signature) {\n  return computeAddress(recoverPublicKey(arrayify(digest), signature));\n}\nfunction formatNumber(value, name) {\n  var result = stripZeros(BigNumber.from(value).toHexString());\n  if (result.length > 32) {\n    logger.throwArgumentError(\"invalid length for \" + name, \"transaction:\" + name, value);\n  }\n  return result;\n}\nfunction accessSetify(addr, storageKeys) {\n  return {\n    address: getAddress(addr),\n    storageKeys: (storageKeys || []).map(function (storageKey, index) {\n      if (hexDataLength(storageKey) !== 32) {\n        logger.throwArgumentError(\"invalid access list storageKey\", \"accessList[\".concat(addr, \":\").concat(index, \"]\"), storageKey);\n      }\n      return storageKey.toLowerCase();\n    })\n  };\n}\nexport function accessListify(value) {\n  if (Array.isArray(value)) {\n    return value.map(function (set, index) {\n      if (Array.isArray(set)) {\n        if (set.length > 2) {\n          logger.throwArgumentError(\"access list expected to be [ address, storageKeys[] ]\", \"value[\".concat(index, \"]\"), set);\n        }\n        return accessSetify(set[0], set[1]);\n      }\n      return accessSetify(set.address, set.storageKeys);\n    });\n  }\n  var result = Object.keys(value).map(function (addr) {\n    var storageKeys = value[addr].reduce(function (accum, storageKey) {\n      accum[storageKey] = true;\n      return accum;\n    }, {});\n    return accessSetify(addr, Object.keys(storageKeys).sort());\n  });\n  result.sort(function (a, b) {\n    return a.address.localeCompare(b.address);\n  });\n  return result;\n}\nfunction formatAccessList(value) {\n  return accessListify(value).map(function (set) {\n    return [set.address, set.storageKeys];\n  });\n}\nfunction _serializeEip2930(transaction, signature) {\n  var fields = [formatNumber(transaction.chainId || 0, \"chainId\"), formatNumber(transaction.nonce || 0, \"nonce\"), formatNumber(transaction.gasPrice || 0, \"gasPrice\"), formatNumber(transaction.gasLimit || 0, \"gasLimit\"), transaction.to != null ? getAddress(transaction.to) : \"0x\", formatNumber(transaction.value || 0, \"value\"), transaction.data || \"0x\", formatAccessList(transaction.accessList || [])];\n  if (signature) {\n    var sig = splitSignature(signature);\n    fields.push(formatNumber(sig.recoveryParam, \"recoveryParam\"));\n    fields.push(stripZeros(sig.r));\n    fields.push(stripZeros(sig.s));\n  }\n  return hexConcat([\"0x01\", RLP.encode(fields)]);\n}\n// Legacy Transactions and EIP-155\nfunction _serialize(transaction, signature) {\n  checkProperties(transaction, allowedTransactionKeys);\n  var raw = [];\n  transactionFields.forEach(function (fieldInfo) {\n    var value = transaction[fieldInfo.name] || [];\n    var options = {};\n    if (fieldInfo.numeric) {\n      options.hexPad = \"left\";\n    }\n    value = arrayify(hexlify(value, options));\n    // Fixed-width field\n    if (fieldInfo.length && value.length !== fieldInfo.length && value.length > 0) {\n      logger.throwArgumentError(\"invalid length for \" + fieldInfo.name, \"transaction:\" + fieldInfo.name, value);\n    }\n    // Variable-width (with a maximum)\n    if (fieldInfo.maxLength) {\n      value = stripZeros(value);\n      if (value.length > fieldInfo.maxLength) {\n        logger.throwArgumentError(\"invalid length for \" + fieldInfo.name, \"transaction:\" + fieldInfo.name, value);\n      }\n    }\n    raw.push(hexlify(value));\n  });\n  var chainId = 0;\n  if (transaction.chainId != null) {\n    // A chainId was provided; if non-zero we'll use EIP-155\n    chainId = transaction.chainId;\n    if (typeof chainId !== \"number\") {\n      logger.throwArgumentError(\"invalid transaction.chainId\", \"transaction\", transaction);\n    }\n  } else if (signature && !isBytesLike(signature) && signature.v > 28) {\n    // No chainId provided, but the signature is signing with EIP-155; derive chainId\n    chainId = Math.floor((signature.v - 35) / 2);\n  }\n  // We have an EIP-155 transaction (chainId was specified and non-zero)\n  if (chainId !== 0) {\n    raw.push(hexlify(chainId)); // @TODO: hexValue?\n    raw.push(\"0x\");\n    raw.push(\"0x\");\n  }\n  // Requesting an unsigned transation\n  if (!signature) {\n    return RLP.encode(raw);\n  }\n  // The splitSignature will ensure the transaction has a recoveryParam in the\n  // case that the signTransaction function only adds a v.\n  var sig = splitSignature(signature);\n  // We pushed a chainId and null r, s on for hashing only; remove those\n  var v = 27 + sig.recoveryParam;\n  if (chainId !== 0) {\n    raw.pop();\n    raw.pop();\n    raw.pop();\n    v += chainId * 2 + 8;\n    // If an EIP-155 v (directly or indirectly; maybe _vs) was provided, check it!\n    if (sig.v > 28 && sig.v !== v) {\n      logger.throwArgumentError(\"transaction.chainId/signature.v mismatch\", \"signature\", signature);\n    }\n  } else if (sig.v !== v) {\n    logger.throwArgumentError(\"transaction.chainId/signature.v mismatch\", \"signature\", signature);\n  }\n  raw.push(hexlify(v));\n  raw.push(stripZeros(arrayify(sig.r)));\n  raw.push(stripZeros(arrayify(sig.s)));\n  return RLP.encode(raw);\n}\nexport function serialize(transaction, signature) {\n  // Legacy and EIP-155 Transactions\n  if (transaction.type == null) {\n    if (transaction.accessList != null) {\n      logger.throwArgumentError(\"untyped transactions do not support accessList; include type: 1\", \"transaction\", transaction);\n    }\n    return _serialize(transaction, signature);\n  }\n  // Typed Transactions (EIP-2718)\n  switch (transaction.type) {\n    case 1:\n      return _serializeEip2930(transaction, signature);\n    default:\n      break;\n  }\n  return logger.throwError(\"unsupported transaction type: \".concat(transaction.type), Logger.errors.UNSUPPORTED_OPERATION, {\n    operation: \"serializeTransaction\",\n    transactionType: transaction.type\n  });\n}\nfunction _parseEip2930(payload) {\n  var transaction = RLP.decode(payload.slice(1));\n  if (transaction.length !== 8 && transaction.length !== 11) {\n    logger.throwArgumentError(\"invalid component count for transaction type: 1\", \"payload\", hexlify(payload));\n  }\n  var tx = {\n    type: 1,\n    chainId: handleNumber(transaction[0]).toNumber(),\n    nonce: handleNumber(transaction[1]).toNumber(),\n    gasPrice: handleNumber(transaction[2]),\n    gasLimit: handleNumber(transaction[3]),\n    to: handleAddress(transaction[4]),\n    value: handleNumber(transaction[5]),\n    data: transaction[6],\n    accessList: accessListify(transaction[7])\n  };\n  // Unsigned EIP-2930 Transaction\n  if (transaction.length === 8) {\n    return tx;\n  }\n  try {\n    var recid = handleNumber(transaction[8]).toNumber();\n    if (recid !== 0 && recid !== 1) {\n      throw new Error(\"bad recid\");\n    }\n    tx.v = recid;\n  } catch (error) {\n    logger.throwArgumentError(\"invalid v for transaction type: 1\", \"v\", transaction[8]);\n  }\n  tx.r = hexZeroPad(transaction[9], 32);\n  tx.s = hexZeroPad(transaction[10], 32);\n  try {\n    var digest = keccak256(_serializeEip2930(tx));\n    tx.from = recoverAddress(digest, {\n      r: tx.r,\n      s: tx.s,\n      recoveryParam: tx.v\n    });\n  } catch (error) {\n    console.log(error);\n  }\n  tx.hash = keccak256(payload);\n  return tx;\n}\n// Legacy Transactions and EIP-155\nfunction _parse(rawTransaction) {\n  var transaction = RLP.decode(rawTransaction);\n  if (transaction.length !== 9 && transaction.length !== 6) {\n    logger.throwArgumentError(\"invalid raw transaction\", \"rawTransaction\", rawTransaction);\n  }\n  var tx = {\n    nonce: handleNumber(transaction[0]).toNumber(),\n    gasPrice: handleNumber(transaction[1]),\n    gasLimit: handleNumber(transaction[2]),\n    to: handleAddress(transaction[3]),\n    value: handleNumber(transaction[4]),\n    data: transaction[5],\n    chainId: 0\n  };\n  // Legacy unsigned transaction\n  if (transaction.length === 6) {\n    return tx;\n  }\n  try {\n    tx.v = BigNumber.from(transaction[6]).toNumber();\n  } catch (error) {\n    console.log(error);\n    return tx;\n  }\n  tx.r = hexZeroPad(transaction[7], 32);\n  tx.s = hexZeroPad(transaction[8], 32);\n  if (BigNumber.from(tx.r).isZero() && BigNumber.from(tx.s).isZero()) {\n    // EIP-155 unsigned transaction\n    tx.chainId = tx.v;\n    tx.v = 0;\n  } else {\n    // Signed Tranasaction\n    tx.chainId = Math.floor((tx.v - 35) / 2);\n    if (tx.chainId < 0) {\n      tx.chainId = 0;\n    }\n    var recoveryParam = tx.v - 27;\n    var raw = transaction.slice(0, 6);\n    if (tx.chainId !== 0) {\n      raw.push(hexlify(tx.chainId));\n      raw.push(\"0x\");\n      raw.push(\"0x\");\n      recoveryParam -= tx.chainId * 2 + 8;\n    }\n    var digest = keccak256(RLP.encode(raw));\n    try {\n      tx.from = recoverAddress(digest, {\n        r: hexlify(tx.r),\n        s: hexlify(tx.s),\n        recoveryParam: recoveryParam\n      });\n    } catch (error) {\n      console.log(error);\n    }\n    tx.hash = keccak256(rawTransaction);\n  }\n  tx.type = null;\n  return tx;\n}\nexport function parse(rawTransaction) {\n  var payload = arrayify(rawTransaction);\n  // Legacy and EIP-155 Transactions\n  if (payload[0] > 0x7f) {\n    return _parse(payload);\n  }\n  // Typed Transaction (EIP-2718)\n  switch (payload[0]) {\n    case 1:\n      return _parseEip2930(payload);\n    default:\n      break;\n  }\n  return logger.throwError(\"unsupported transaction type: \".concat(payload[0]), Logger.errors.UNSUPPORTED_OPERATION, {\n    operation: \"parseTransaction\",\n    transactionType: payload[0]\n  });\n}","map":{"version":3,"names":["getAddress","BigNumber","arrayify","hexConcat","hexDataLength","hexDataSlice","hexlify","hexZeroPad","isBytesLike","splitSignature","stripZeros","Zero","keccak256","checkProperties","RLP","computePublicKey","recoverPublicKey","Logger","version","logger","handleAddress","value","handleNumber","from","transactionFields","name","maxLength","numeric","length","allowedTransactionKeys","chainId","data","gasLimit","gasPrice","nonce","to","computeAddress","key","publicKey","recoverAddress","digest","signature","formatNumber","result","toHexString","throwArgumentError","accessSetify","addr","storageKeys","address","map","storageKey","index","concat","toLowerCase","accessListify","Array","isArray","set","Object","keys","reduce","accum","sort","a","b","localeCompare","formatAccessList","_serializeEip2930","transaction","fields","accessList","sig","push","recoveryParam","r","s","encode","_serialize","raw","forEach","fieldInfo","options","hexPad","v","Math","floor","pop","serialize","type","throwError","errors","UNSUPPORTED_OPERATION","operation","transactionType","_parseEip2930","payload","decode","slice","tx","toNumber","recid","Error","error","console","log","hash","_parse","rawTransaction","isZero","parse"],"sources":["../src.ts/index.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module"}