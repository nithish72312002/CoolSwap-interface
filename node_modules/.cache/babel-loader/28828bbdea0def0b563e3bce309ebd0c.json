{"ast":null,"code":"import _slicedToArray from \"E:\\\\testprojects\\\\CoolSwap-interface\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nimport { useCallback, useEffect, useState } from 'react';\nimport { useActiveWeb3React } from '../../hooks';\nimport useDebounce from '../../hooks/useDebounce';\nimport useIsWindowVisible from '../../hooks/useIsWindowVisible';\nimport { updateBlockNumber } from './actions';\nimport { useDispatch } from 'react-redux';\nexport default function Updater() {\n  var _useActiveWeb3React = useActiveWeb3React(),\n    library = _useActiveWeb3React.library,\n    chainId = _useActiveWeb3React.chainId;\n  var dispatch = useDispatch();\n  var windowVisible = useIsWindowVisible();\n  var _useState = useState({\n      chainId: chainId,\n      blockNumber: null\n    }),\n    _useState2 = _slicedToArray(_useState, 2),\n    state = _useState2[0],\n    setState = _useState2[1];\n  var blockNumberCallback = useCallback(function (blockNumber) {\n    setState(function (state) {\n      if (chainId === state.chainId) {\n        if (typeof state.blockNumber !== 'number') return {\n          chainId: chainId,\n          blockNumber: blockNumber\n        };\n        return {\n          chainId: chainId,\n          blockNumber: Math.max(blockNumber, state.blockNumber)\n        };\n      }\n      return state;\n    });\n  }, [chainId, setState]);\n\n  // attach/detach listeners\n  useEffect(function () {\n    if (!library || !chainId || !windowVisible) return undefined;\n    setState({\n      chainId: chainId,\n      blockNumber: null\n    });\n    library.getBlockNumber().then(blockNumberCallback).catch(function (error) {\n      return console.error(\"Failed to get block number for chainId: \".concat(chainId), error);\n    });\n    library.on('block', blockNumberCallback);\n    return function () {\n      library.removeListener('block', blockNumberCallback);\n    };\n  }, [dispatch, chainId, library, blockNumberCallback, windowVisible]);\n  var debouncedState = useDebounce(state, 100);\n  useEffect(function () {\n    if (!debouncedState.chainId || !debouncedState.blockNumber || !windowVisible) return;\n    dispatch(updateBlockNumber({\n      chainId: debouncedState.chainId,\n      blockNumber: debouncedState.blockNumber\n    }));\n  }, [windowVisible, dispatch, debouncedState.blockNumber, debouncedState.chainId]);\n  return null;\n}","map":{"version":3,"names":["useCallback","useEffect","useState","useActiveWeb3React","useDebounce","useIsWindowVisible","updateBlockNumber","useDispatch","Updater","_useActiveWeb3React","library","chainId","dispatch","windowVisible","_useState","blockNumber","_useState2","_slicedToArray","state","setState","blockNumberCallback","Math","max","undefined","getBlockNumber","then","catch","error","console","concat","on","removeListener","debouncedState"],"sources":["E:/testprojects/CoolSwap-interface/src/state/application/updater.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from 'react';\r\nimport { useActiveWeb3React } from '../../hooks';\r\nimport useDebounce from '../../hooks/useDebounce';\r\nimport useIsWindowVisible from '../../hooks/useIsWindowVisible';\r\nimport { updateBlockNumber } from './actions';\r\nimport { useDispatch } from 'react-redux';\r\n\r\nexport default function Updater(): null {\r\n  const { library, chainId } = useActiveWeb3React();\r\n  const dispatch = useDispatch();\r\n\r\n  const windowVisible = useIsWindowVisible();\r\n\r\n  const [state, setState] = useState<{ chainId: number | undefined; blockNumber: number | null }>({\r\n    chainId,\r\n    blockNumber: null,\r\n  });\r\n\r\n  const blockNumberCallback = useCallback(\r\n    (blockNumber: number) => {\r\n      setState((state) => {\r\n        if (chainId === state.chainId) {\r\n          if (typeof state.blockNumber !== 'number') return { chainId, blockNumber };\r\n          return { chainId, blockNumber: Math.max(blockNumber, state.blockNumber) };\r\n        }\r\n        return state;\r\n      });\r\n    },\r\n    [chainId, setState]\r\n  );\r\n\r\n  // attach/detach listeners\r\n  useEffect(() => {\r\n    if (!library || !chainId || !windowVisible) return undefined;\r\n\r\n    setState({ chainId, blockNumber: null });\r\n\r\n    library\r\n      .getBlockNumber()\r\n      .then(blockNumberCallback)\r\n      .catch((error) => console.error(`Failed to get block number for chainId: ${chainId}`, error));\r\n\r\n    library.on('block', blockNumberCallback);\r\n    return () => {\r\n      library.removeListener('block', blockNumberCallback);\r\n    };\r\n  }, [dispatch, chainId, library, blockNumberCallback, windowVisible]);\r\n\r\n  const debouncedState = useDebounce(state, 100);\r\n\r\n  useEffect(() => {\r\n    if (!debouncedState.chainId || !debouncedState.blockNumber || !windowVisible) return;\r\n    dispatch(updateBlockNumber({ chainId: debouncedState.chainId, blockNumber: debouncedState.blockNumber }));\r\n  }, [windowVisible, dispatch, debouncedState.blockNumber, debouncedState.chainId]);\r\n\r\n  return null;\r\n}\r\n"],"mappings":";AAAA,SAASA,WAAW,EAAEC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AACxD,SAASC,kBAAkB,QAAQ,aAAa;AAChD,OAAOC,WAAW,MAAM,yBAAyB;AACjD,OAAOC,kBAAkB,MAAM,gCAAgC;AAC/D,SAASC,iBAAiB,QAAQ,WAAW;AAC7C,SAASC,WAAW,QAAQ,aAAa;AAEzC,eAAe,SAASC,OAAOA,CAAA,EAAS;EACtC,IAAAC,mBAAA,GAA6BN,kBAAkB,CAAC,CAAC;IAAzCO,OAAO,GAAAD,mBAAA,CAAPC,OAAO;IAAEC,OAAO,GAAAF,mBAAA,CAAPE,OAAO;EACxB,IAAMC,QAAQ,GAAGL,WAAW,CAAC,CAAC;EAE9B,IAAMM,aAAa,GAAGR,kBAAkB,CAAC,CAAC;EAE1C,IAAAS,SAAA,GAA0BZ,QAAQ,CAA8D;MAC9FS,OAAO,EAAPA,OAAO;MACPI,WAAW,EAAE;IACf,CAAC,CAAC;IAAAC,UAAA,GAAAC,cAAA,CAAAH,SAAA;IAHKI,KAAK,GAAAF,UAAA;IAAEG,QAAQ,GAAAH,UAAA;EAKtB,IAAMI,mBAAmB,GAAGpB,WAAW,CACrC,UAACe,WAAmB,EAAK;IACvBI,QAAQ,CAAC,UAACD,KAAK,EAAK;MAClB,IAAIP,OAAO,KAAKO,KAAK,CAACP,OAAO,EAAE;QAC7B,IAAI,OAAOO,KAAK,CAACH,WAAW,KAAK,QAAQ,EAAE,OAAO;UAAEJ,OAAO,EAAPA,OAAO;UAAEI,WAAW,EAAXA;QAAY,CAAC;QAC1E,OAAO;UAAEJ,OAAO,EAAPA,OAAO;UAAEI,WAAW,EAAEM,IAAI,CAACC,GAAG,CAACP,WAAW,EAAEG,KAAK,CAACH,WAAW;QAAE,CAAC;MAC3E;MACA,OAAOG,KAAK;IACd,CAAC,CAAC;EACJ,CAAC,EACD,CAACP,OAAO,EAAEQ,QAAQ,CACpB,CAAC;;EAED;EACAlB,SAAS,CAAC,YAAM;IACd,IAAI,CAACS,OAAO,IAAI,CAACC,OAAO,IAAI,CAACE,aAAa,EAAE,OAAOU,SAAS;IAE5DJ,QAAQ,CAAC;MAAER,OAAO,EAAPA,OAAO;MAAEI,WAAW,EAAE;IAAK,CAAC,CAAC;IAExCL,OAAO,CACJc,cAAc,CAAC,CAAC,CAChBC,IAAI,CAACL,mBAAmB,CAAC,CACzBM,KAAK,CAAC,UAACC,KAAK;MAAA,OAAKC,OAAO,CAACD,KAAK,4CAAAE,MAAA,CAA4ClB,OAAO,GAAIgB,KAAK,CAAC;IAAA,EAAC;IAE/FjB,OAAO,CAACoB,EAAE,CAAC,OAAO,EAAEV,mBAAmB,CAAC;IACxC,OAAO,YAAM;MACXV,OAAO,CAACqB,cAAc,CAAC,OAAO,EAAEX,mBAAmB,CAAC;IACtD,CAAC;EACH,CAAC,EAAE,CAACR,QAAQ,EAAED,OAAO,EAAED,OAAO,EAAEU,mBAAmB,EAAEP,aAAa,CAAC,CAAC;EAEpE,IAAMmB,cAAc,GAAG5B,WAAW,CAACc,KAAK,EAAE,GAAG,CAAC;EAE9CjB,SAAS,CAAC,YAAM;IACd,IAAI,CAAC+B,cAAc,CAACrB,OAAO,IAAI,CAACqB,cAAc,CAACjB,WAAW,IAAI,CAACF,aAAa,EAAE;IAC9ED,QAAQ,CAACN,iBAAiB,CAAC;MAAEK,OAAO,EAAEqB,cAAc,CAACrB,OAAO;MAAEI,WAAW,EAAEiB,cAAc,CAACjB;IAAY,CAAC,CAAC,CAAC;EAC3G,CAAC,EAAE,CAACF,aAAa,EAAED,QAAQ,EAAEoB,cAAc,CAACjB,WAAW,EAAEiB,cAAc,CAACrB,OAAO,CAAC,CAAC;EAEjF,OAAO,IAAI;AACb"},"metadata":{},"sourceType":"module"}