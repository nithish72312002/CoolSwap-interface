{"ast":null,"code":"\"use strict\";\n\n// Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\nvar _slicedToArray = require(\"E:\\\\testprojects\\\\CoolSwap-interface\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/slicedToArray\");\nvar _classCallCheck = require(\"E:\\\\testprojects\\\\CoolSwap-interface\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/classCallCheck\");\nvar _createClass = require(\"E:\\\\testprojects\\\\CoolSwap-interface\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/createClass\");\nvar _inherits = require(\"E:\\\\testprojects\\\\CoolSwap-interface\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/inherits\");\nvar _createSuper = require(\"E:\\\\testprojects\\\\CoolSwap-interface\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/createSuper\");\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WalletLinkRelay = void 0;\nvar bind_decorator_1 = __importDefault(require(\"bind-decorator\"));\nvar eth_rpc_errors_1 = require(\"eth-rpc-errors\");\nvar rxjs_1 = require(\"rxjs\");\nvar operators_1 = require(\"rxjs/operators\");\nvar WalletLinkAnalytics_1 = require(\"../connection/WalletLinkAnalytics\");\nvar WalletLinkConnection_1 = require(\"../connection/WalletLinkConnection\");\nvar init_1 = require(\"../init\");\nvar util_1 = require(\"../util\");\nvar aes256gcm = __importStar(require(\"./aes256gcm\"));\nvar Session_1 = require(\"./Session\");\nvar WalletLinkRelayAbstract_1 = require(\"./WalletLinkRelayAbstract\");\nvar Web3Method_1 = require(\"./Web3Method\");\nvar Web3RequestCanceledMessage_1 = require(\"./Web3RequestCanceledMessage\");\nvar Web3RequestMessage_1 = require(\"./Web3RequestMessage\");\nvar Web3Response_1 = require(\"./Web3Response\");\nvar Web3ResponseMessage_1 = require(\"./Web3ResponseMessage\");\nvar WalletLinkRelay = /*#__PURE__*/function (_WalletLinkRelayAbstr) {\n  _inherits(WalletLinkRelay, _WalletLinkRelayAbstr);\n  var _super = _createSuper(WalletLinkRelay);\n  function WalletLinkRelay(options) {\n    var _this;\n    _classCallCheck(this, WalletLinkRelay);\n    _this = _super.call(this);\n    _this.accountsCallback = null;\n    _this.chainCallback = null;\n    _this.appName = \"\";\n    _this.appLogoUrl = null;\n    _this.subscriptions = new rxjs_1.Subscription();\n    _this.walletLinkUrl = options.walletLinkUrl;\n    _this.storage = options.storage;\n    _this._session = Session_1.Session.load(options.storage) || new Session_1.Session(options.storage).save();\n    _this.relayEventManager = options.relayEventManager;\n    _this.walletLinkAnalytics = options.walletLinkAnalytics ? options.walletLinkAnalytics : new WalletLinkAnalytics_1.WalletLinkAnalytics();\n    _this.connection = new WalletLinkConnection_1.WalletLinkConnection(_this._session.id, _this._session.key, _this.walletLinkUrl, _this.walletLinkAnalytics);\n    _this.subscriptions.add(_this.connection.incomingEvent$.pipe((0, operators_1.filter)(function (m) {\n      return m.event === \"Web3Response\";\n    })).subscribe({\n      next: _this.handleIncomingEvent\n    }) // eslint-disable-line @typescript-eslint/unbound-method\n    );\n\n    _this.subscriptions.add(_this.connection.linked$.pipe((0, operators_1.skip)(1), (0, operators_1.tap)(function (linked) {\n      var _a;\n      _this.isLinked = linked;\n      var cachedAddresses = _this.storage.getItem(WalletLinkRelayAbstract_1.LOCAL_STORAGE_ADDRESSES_KEY);\n      if (linked) {\n        // Only set linked session variable one way\n        _this.session.linked = linked;\n      }\n      _this.isUnlinkedErrorState = false;\n      if (cachedAddresses) {\n        var addresses = cachedAddresses.split(\" \");\n        var wasConnectedViaStandalone = _this.storage.getItem(\"IsStandaloneSigning\") === \"true\";\n        if (addresses[0] !== \"\" && !linked && _this.session.linked && !wasConnectedViaStandalone) {\n          _this.isUnlinkedErrorState = true;\n          var sessionIdHash = _this.getSessionIdHash();\n          (_a = _this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.UNLINKED_ERROR_STATE, {\n            sessionIdHash: sessionIdHash,\n            origin: location.origin\n          });\n        }\n      }\n    })).subscribe());\n    // if session is marked destroyed, reset and reload\n    _this.subscriptions.add(_this.connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n      return !!c.metadata && c.metadata.__destroyed === \"1\";\n    })).subscribe(function () {\n      var _a;\n      var alreadyDestroyed = _this.connection.isDestroyed;\n      (_a = _this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.METADATA_DESTROYED, {\n        alreadyDestroyed: alreadyDestroyed,\n        sessionIdHash: _this.getSessionIdHash(),\n        origin: location.origin\n      });\n      return _this.resetAndReload();\n    }));\n    _this.subscriptions.add(_this.connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n      return c.metadata && c.metadata.WalletUsername !== undefined;\n    })).pipe((0, operators_1.mergeMap)(function (c) {\n      return aes256gcm.decrypt(c.metadata.WalletUsername, _this._session.secret);\n    })).subscribe({\n      next: function next(walletUsername) {\n        _this.storage.setItem(WalletLinkRelayAbstract_1.WALLET_USER_NAME_KEY, walletUsername);\n      },\n      error: function error() {\n        var _a;\n        (_a = _this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n          message: \"Had error decrypting\",\n          value: \"username\"\n        });\n      }\n    }));\n    _this.subscriptions.add(_this.connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n      return c.metadata && c.metadata.AppVersion !== undefined;\n    })).pipe((0, operators_1.mergeMap)(function (c) {\n      return aes256gcm.decrypt(c.metadata.AppVersion, _this._session.secret);\n    })).subscribe({\n      next: function next(appVersion) {\n        _this.storage.setItem(WalletLinkRelayAbstract_1.APP_VERSION_KEY, appVersion);\n      },\n      error: function error() {\n        var _a;\n        (_a = _this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n          message: \"Had error decrypting\",\n          value: \"appversion\"\n        });\n      }\n    }));\n    _this.subscriptions.add(_this.connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n      return c.metadata && c.metadata.ChainId !== undefined && c.metadata.JsonRpcUrl !== undefined;\n    })).pipe((0, operators_1.mergeMap)(function (c) {\n      return (0, rxjs_1.zip)(aes256gcm.decrypt(c.metadata.ChainId, _this._session.secret), aes256gcm.decrypt(c.metadata.JsonRpcUrl, _this._session.secret));\n    })).pipe((0, operators_1.distinctUntilChanged)()).subscribe({\n      next: function next(_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n          chainId = _ref2[0],\n          jsonRpcUrl = _ref2[1];\n        if (_this.chainCallback) {\n          _this.chainCallback(chainId, jsonRpcUrl);\n        }\n      },\n      error: function error() {\n        var _a;\n        (_a = _this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n          message: \"Had error decrypting\",\n          value: \"chainId|jsonRpcUrl\"\n        });\n      }\n    }));\n    _this.subscriptions.add(_this.connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n      return c.metadata && c.metadata.EthereumAddress !== undefined;\n    })).pipe((0, operators_1.mergeMap)(function (c) {\n      return aes256gcm.decrypt(c.metadata.EthereumAddress, _this._session.secret);\n    })).subscribe({\n      next: function next(selectedAddress) {\n        if (_this.accountsCallback) {\n          _this.accountsCallback([selectedAddress]);\n        }\n        if (WalletLinkRelay.accountRequestCallbackIds.size > 0) {\n          // We get the ethereum address from the metadata.  If for whatever\n          // reason we don't get a response via an explicit web3 message\n          // we can still fulfill the eip1102 request.\n          Array.from(WalletLinkRelay.accountRequestCallbackIds.values()).forEach(function (id) {\n            var message = (0, Web3ResponseMessage_1.Web3ResponseMessage)({\n              id: id,\n              response: (0, Web3Response_1.RequestEthereumAccountsResponse)([selectedAddress])\n            });\n            _this.invokeCallback(Object.assign(Object.assign({}, message), {\n              id: id\n            }));\n          });\n          WalletLinkRelay.accountRequestCallbackIds.clear();\n        }\n      },\n      error: function error() {\n        var _a;\n        (_a = _this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n          message: \"Had error decrypting\",\n          value: \"selectedAddress\"\n        });\n      }\n    }));\n    _this.ui = options.walletLinkUIConstructor({\n      walletLinkUrl: options.walletLinkUrl,\n      version: options.version,\n      darkMode: options.darkMode,\n      session: _this._session,\n      connected$: _this.connection.connected$\n    });\n    _this.connection.connect();\n    return _this;\n  }\n  _createClass(WalletLinkRelay, [{\n    key: \"attachUI\",\n    value: function attachUI() {\n      this.ui.attach();\n    }\n  }, {\n    key: \"resetAndReload\",\n    value: function resetAndReload() {\n      var _this2 = this;\n      this.connection.setSessionMetadata(\"__destroyed\", \"1\").pipe((0, operators_1.timeout)(1000), (0, operators_1.catchError)(function (_) {\n        return (0, rxjs_1.of)(null);\n      })).subscribe(function (_) {\n        var _a, _b, _c;\n        try {\n          _this2.subscriptions.unsubscribe();\n        } catch (err) {\n          (_a = _this2.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n            message: \"Had error unsubscribing\"\n          });\n        }\n        (_b = _this2.walletLinkAnalytics) === null || _b === void 0 ? void 0 : _b.sendEvent(init_1.EVENTS.SESSION_STATE_CHANGE, {\n          method: \"relay::resetAndReload\",\n          sessionMetadataChange: \"__destroyed, 1\",\n          sessionIdHash: _this2.getSessionIdHash(),\n          origin: location.origin\n        });\n        _this2.connection.destroy();\n        /**\n         * Only clear storage if the session id we have in memory matches the one on disk\n         * Otherwise, in the case where we have 2 tabs, another tab might have cleared\n         * storage already.  In that case if we clear storage again, the user will be in\n         * a state where the first tab allows the user to connect but the session that\n         * was used isn't persisted.  This leaves the user in a state where they aren't\n         * connected to the mobile app.\n         */\n        var storedSession = Session_1.Session.load(_this2.storage);\n        if ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) === _this2._session.id) {\n          _this2.storage.clear();\n        } else if (storedSession) {\n          (_c = _this2.walletLinkAnalytics) === null || _c === void 0 ? void 0 : _c.sendEvent(init_1.EVENTS.SKIPPED_CLEARING_SESSION, {\n            sessionIdHash: _this2.getSessionIdHash(),\n            storedSessionIdHash: Session_1.Session.hash(storedSession.id),\n            origin: location.origin\n          });\n        }\n        _this2.ui.reloadUI();\n      }, function (err) {\n        var _a;\n        (_a = _this2.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.FAILURE, {\n          method: \"relay::resetAndReload\",\n          message: \"failed to reset and reload with \".concat(err),\n          sessionIdHash: _this2.getSessionIdHash()\n        });\n      });\n    }\n  }, {\n    key: \"setAppInfo\",\n    value: function setAppInfo(appName, appLogoUrl) {\n      this.appName = appName;\n      this.appLogoUrl = appLogoUrl;\n    }\n  }, {\n    key: \"getStorageItem\",\n    value: function getStorageItem(key) {\n      return this.storage.getItem(key);\n    }\n  }, {\n    key: \"session\",\n    get: function get() {\n      return this._session;\n    }\n  }, {\n    key: \"setStorageItem\",\n    value: function setStorageItem(key, value) {\n      this.storage.setItem(key, value);\n    }\n  }, {\n    key: \"signEthereumMessage\",\n    value: function signEthereumMessage(message, address, addPrefix, typedDataJson) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.signEthereumMessage,\n        params: {\n          message: (0, util_1.hexStringFromBuffer)(message, true),\n          address: address,\n          addPrefix: addPrefix,\n          typedDataJson: typedDataJson || null\n        }\n      });\n    }\n  }, {\n    key: \"ethereumAddressFromSignedMessage\",\n    value: function ethereumAddressFromSignedMessage(message, signature, addPrefix) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.ethereumAddressFromSignedMessage,\n        params: {\n          message: (0, util_1.hexStringFromBuffer)(message, true),\n          signature: (0, util_1.hexStringFromBuffer)(signature, true),\n          addPrefix: addPrefix\n        }\n      });\n    }\n  }, {\n    key: \"signEthereumTransaction\",\n    value: function signEthereumTransaction(params) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.signEthereumTransaction,\n        params: {\n          fromAddress: params.fromAddress,\n          toAddress: params.toAddress,\n          weiValue: (0, util_1.bigIntStringFromBN)(params.weiValue),\n          data: (0, util_1.hexStringFromBuffer)(params.data, true),\n          nonce: params.nonce,\n          gasPriceInWei: params.gasPriceInWei ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei) : null,\n          maxFeePerGas: params.gasPriceInWei ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei) : null,\n          maxPriorityFeePerGas: params.gasPriceInWei ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei) : null,\n          gasLimit: params.gasLimit ? (0, util_1.bigIntStringFromBN)(params.gasLimit) : null,\n          chainId: params.chainId,\n          shouldSubmit: false\n        }\n      });\n    }\n  }, {\n    key: \"signAndSubmitEthereumTransaction\",\n    value: function signAndSubmitEthereumTransaction(params) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.signEthereumTransaction,\n        params: {\n          fromAddress: params.fromAddress,\n          toAddress: params.toAddress,\n          weiValue: (0, util_1.bigIntStringFromBN)(params.weiValue),\n          data: (0, util_1.hexStringFromBuffer)(params.data, true),\n          nonce: params.nonce,\n          gasPriceInWei: params.gasPriceInWei ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei) : null,\n          maxFeePerGas: params.maxFeePerGas ? (0, util_1.bigIntStringFromBN)(params.maxFeePerGas) : null,\n          maxPriorityFeePerGas: params.maxPriorityFeePerGas ? (0, util_1.bigIntStringFromBN)(params.maxPriorityFeePerGas) : null,\n          gasLimit: params.gasLimit ? (0, util_1.bigIntStringFromBN)(params.gasLimit) : null,\n          chainId: params.chainId,\n          shouldSubmit: true\n        }\n      });\n    }\n  }, {\n    key: \"submitEthereumTransaction\",\n    value: function submitEthereumTransaction(signedTransaction, chainId) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.submitEthereumTransaction,\n        params: {\n          signedTransaction: (0, util_1.hexStringFromBuffer)(signedTransaction, true),\n          chainId: chainId\n        }\n      });\n    }\n  }, {\n    key: \"scanQRCode\",\n    value: function scanQRCode(regExp) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.scanQRCode,\n        params: {\n          regExp: regExp\n        }\n      });\n    }\n  }, {\n    key: \"genericRequest\",\n    value: function genericRequest(data, action) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.generic,\n        params: {\n          action: action,\n          data: data\n        }\n      });\n    }\n  }, {\n    key: \"sendGenericMessage\",\n    value: function sendGenericMessage(request) {\n      return this.sendRequest(request);\n    }\n  }, {\n    key: \"sendRequest\",\n    value: function sendRequest(request) {\n      var _this3 = this;\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n      var cancel = function cancel() {\n        _this3.publishWeb3RequestCanceledEvent(id);\n        _this3.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n          id: id,\n          response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n        }));\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n      var promise = new Promise(function (resolve, reject) {\n        if (!_this3.ui.isStandalone()) {\n          hideSnackbarItem = _this3.ui.showConnecting({\n            isUnlinkedErrorState: _this3.isUnlinkedErrorState,\n            onCancel: cancel,\n            onResetConnection: _this3.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n          });\n        }\n\n        _this3.relayEventManager.callbacks.set(id, function (response) {\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n          resolve(response);\n        });\n        if (_this3.ui.isStandalone()) {\n          _this3.sendRequestStandalone(id, request);\n        } else {\n          _this3.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        promise: promise,\n        cancel: cancel\n      };\n    }\n  }, {\n    key: \"setConnectDisabled\",\n    value: function setConnectDisabled(disabled) {\n      this.ui.setConnectDisabled(disabled);\n    }\n  }, {\n    key: \"setAccountsCallback\",\n    value: function setAccountsCallback(accountsCallback) {\n      this.accountsCallback = accountsCallback;\n    }\n  }, {\n    key: \"setChainCallback\",\n    value: function setChainCallback(chainCallback) {\n      this.chainCallback = chainCallback;\n    }\n  }, {\n    key: \"publishWeb3RequestEvent\",\n    value: function publishWeb3RequestEvent(id, request) {\n      var _this4 = this;\n      var _a;\n      var message = (0, Web3RequestMessage_1.Web3RequestMessage)({\n        id: id,\n        request: request\n      });\n      var storedSession = Session_1.Session.load(this.storage);\n      (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.WEB3_REQUEST, {\n        eventId: message.id,\n        method: \"relay::\".concat(message.request.method),\n        sessionIdHash: this.getSessionIdHash(),\n        storedSessionIdHash: storedSession ? Session_1.Session.hash(storedSession.id) : \"\",\n        isSessionMismatched: ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) !== this._session.id).toString(),\n        origin: location.origin\n      });\n      this.subscriptions.add(this.publishEvent(\"Web3Request\", message, true).subscribe({\n        next: function next(_) {\n          var _a;\n          (_a = _this4.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.WEB3_REQUEST_PUBLISHED, {\n            eventId: message.id,\n            method: \"relay::\".concat(message.request.method),\n            sessionIdHash: _this4.getSessionIdHash(),\n            storedSessionIdHash: storedSession ? Session_1.Session.hash(storedSession.id) : \"\",\n            isSessionMismatched: ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) !== _this4._session.id).toString(),\n            origin: location.origin\n          });\n        },\n        error: function error(err) {\n          _this4.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: message.id,\n            response: {\n              method: message.request.method,\n              errorMessage: err.message\n            }\n          }));\n        }\n      }));\n    }\n  }, {\n    key: \"publishWeb3RequestCanceledEvent\",\n    value: function publishWeb3RequestCanceledEvent(id) {\n      var message = (0, Web3RequestCanceledMessage_1.Web3RequestCanceledMessage)(id);\n      this.subscriptions.add(this.publishEvent(\"Web3RequestCanceled\", message, false).subscribe());\n    }\n  }, {\n    key: \"publishEvent\",\n    value: function publishEvent(event, message, callWebhook) {\n      var _this5 = this;\n      var secret = this.session.secret;\n      return new rxjs_1.Observable(function (subscriber) {\n        void aes256gcm.encrypt(JSON.stringify(Object.assign(Object.assign({}, message), {\n          origin: location.origin\n        })), secret).then(function (encrypted) {\n          subscriber.next(encrypted);\n          subscriber.complete();\n        });\n      }).pipe((0, operators_1.mergeMap)(function (encrypted) {\n        return _this5.connection.publishEvent(event, encrypted, callWebhook);\n      }));\n    }\n  }, {\n    key: \"handleIncomingEvent\",\n    value: function handleIncomingEvent(event) {\n      var _this6 = this;\n      try {\n        this.subscriptions.add(aes256gcm.decrypt(event.data, this.session.secret).pipe((0, operators_1.map)(function (c) {\n          return JSON.parse(c);\n        })).subscribe({\n          next: function next(json) {\n            var message = (0, Web3ResponseMessage_1.isWeb3ResponseMessage)(json) ? json : null;\n            if (!message) {\n              return;\n            }\n            _this6.handleWeb3ResponseMessage(message);\n          },\n          error: function error() {\n            var _a;\n            (_a = _this6.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n              message: \"Had error decrypting\",\n              value: \"incomingEvent\"\n            });\n          }\n        }));\n      } catch (_a) {\n        return;\n      }\n    }\n  }, {\n    key: \"handleWeb3ResponseMessage\",\n    value: function handleWeb3ResponseMessage(message) {\n      var _this7 = this;\n      var _a;\n      var response = message.response;\n      (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.WEB3_RESPONSE, {\n        eventId: message.id,\n        method: \"relay::\".concat(response.method),\n        sessionIdHash: this.getSessionIdHash(),\n        origin: location.origin\n      });\n      if ((0, Web3Response_1.isRequestEthereumAccountsResponse)(response)) {\n        Array.from(WalletLinkRelay.accountRequestCallbackIds.values()).forEach(function (id) {\n          return _this7.invokeCallback(Object.assign(Object.assign({}, message), {\n            id: id\n          }));\n        });\n        WalletLinkRelay.accountRequestCallbackIds.clear();\n        return;\n      }\n      this.invokeCallback(message);\n    }\n  }, {\n    key: \"invokeCallback\",\n    value: function invokeCallback(message) {\n      var callback = this.relayEventManager.callbacks.get(message.id);\n      if (callback) {\n        callback(message.response);\n        this.relayEventManager.callbacks.delete(message.id);\n      }\n    }\n  }, {\n    key: \"requestEthereumAccounts\",\n    value: function requestEthereumAccounts() {\n      var _this8 = this;\n      var request = {\n        method: Web3Method_1.Web3Method.requestEthereumAccounts,\n        params: {\n          appName: this.appName,\n          appLogoUrl: this.appLogoUrl || null\n        }\n      };\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n      var cancel = function cancel() {\n        _this8.publishWeb3RequestCanceledEvent(id);\n        _this8.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n          id: id,\n          response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n        }));\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n      var promise = new Promise(function (resolve, reject) {\n        var _a;\n        _this8.relayEventManager.callbacks.set(id, function (response) {\n          _this8.ui.hideRequestEthereumAccounts();\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n          resolve(response);\n        });\n        var userAgent = ((_a = window === null || window === void 0 ? void 0 : window.navigator) === null || _a === void 0 ? void 0 : _a.userAgent) || null;\n        if (userAgent && /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)) {\n          window.location.href = \"https://go.cb-w.com/xoXnYwQimhb?cb_url=\".concat(encodeURIComponent(window.location.href));\n          return;\n        }\n        if (_this8.ui.inlineAccountsResponse()) {\n          var onAccounts = function onAccounts(accounts) {\n            _this8.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n              id: id,\n              response: (0, Web3Response_1.RequestEthereumAccountsResponse)(accounts)\n            }));\n          };\n          _this8.ui.requestEthereumAccounts({\n            onCancel: cancel,\n            onAccounts: onAccounts\n          });\n        } else {\n          _this8.ui.requestEthereumAccounts({\n            onCancel: cancel\n          });\n        }\n        WalletLinkRelay.accountRequestCallbackIds.add(id);\n        if (!_this8.ui.inlineAccountsResponse() && !_this8.ui.isStandalone()) {\n          _this8.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        promise: promise,\n        cancel: cancel\n      };\n    }\n  }, {\n    key: \"watchAsset\",\n    value: function watchAsset(type, address, symbol, decimals, image) {\n      var _this9 = this;\n      var request = {\n        method: Web3Method_1.Web3Method.watchAsset,\n        params: {\n          type: type,\n          options: {\n            address: address,\n            symbol: symbol,\n            decimals: decimals,\n            image: image\n          }\n        }\n      };\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n      var cancel = function cancel() {\n        _this9.publishWeb3RequestCanceledEvent(id);\n        _this9.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n          id: id,\n          response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n        }));\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n      if (!this.ui.inlineWatchAsset()) {\n        hideSnackbarItem = this.ui.showConnecting({\n          isUnlinkedErrorState: this.isUnlinkedErrorState,\n          onCancel: cancel,\n          onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n        });\n      }\n\n      var promise = new Promise(function (resolve, reject) {\n        _this9.relayEventManager.callbacks.set(id, function (response) {\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n          resolve(response);\n        });\n        var _cancel = function _cancel() {\n          _this9.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.WatchAssetReponse)(false)\n          }));\n        };\n        var approve = function approve() {\n          _this9.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.WatchAssetReponse)(true)\n          }));\n        };\n        if (_this9.ui.inlineWatchAsset()) {\n          _this9.ui.watchAsset({\n            onApprove: approve,\n            onCancel: _cancel,\n            type: type,\n            address: address,\n            symbol: symbol,\n            decimals: decimals,\n            image: image\n          });\n        }\n        if (!_this9.ui.inlineWatchAsset() && !_this9.ui.isStandalone()) {\n          _this9.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        cancel: cancel,\n        promise: promise\n      };\n    }\n  }, {\n    key: \"addEthereumChain\",\n    value: function addEthereumChain(chainId, rpcUrls, iconUrls, blockExplorerUrls, chainName, nativeCurrency) {\n      var _this10 = this;\n      var request = {\n        method: Web3Method_1.Web3Method.addEthereumChain,\n        params: {\n          chainId: chainId,\n          rpcUrls: rpcUrls,\n          blockExplorerUrls: blockExplorerUrls,\n          chainName: chainName,\n          iconUrls: iconUrls,\n          nativeCurrency: nativeCurrency\n        }\n      };\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n      var cancel = function cancel() {\n        _this10.publishWeb3RequestCanceledEvent(id);\n        _this10.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n          id: id,\n          response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n        }));\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n      if (!this.ui.inlineAddEthereumChain(chainId)) {\n        hideSnackbarItem = this.ui.showConnecting({\n          isUnlinkedErrorState: this.isUnlinkedErrorState,\n          onCancel: cancel,\n          onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n        });\n      }\n\n      var promise = new Promise(function (resolve, reject) {\n        _this10.relayEventManager.callbacks.set(id, function (response) {\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n          resolve(response);\n        });\n        var _cancel = function _cancel() {\n          _this10.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.AddEthereumChainResponse)({\n              isApproved: false,\n              rpcUrl: \"\"\n            })\n          }));\n        };\n        var approve = function approve(rpcUrl) {\n          _this10.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.AddEthereumChainResponse)({\n              isApproved: true,\n              rpcUrl: rpcUrl\n            })\n          }));\n        };\n        if (_this10.ui.inlineAddEthereumChain(chainId)) {\n          _this10.ui.addEthereumChain({\n            onCancel: _cancel,\n            onApprove: approve,\n            chainId: request.params.chainId,\n            rpcUrls: request.params.rpcUrls,\n            blockExplorerUrls: request.params.blockExplorerUrls,\n            chainName: request.params.chainName,\n            iconUrls: request.params.iconUrls,\n            nativeCurrency: request.params.nativeCurrency\n          });\n        }\n        if (!_this10.ui.inlineAddEthereumChain(chainId) && !_this10.ui.isStandalone()) {\n          _this10.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        promise: promise,\n        cancel: cancel\n      };\n    }\n  }, {\n    key: \"switchEthereumChain\",\n    value: function switchEthereumChain(chainId) {\n      var _this11 = this;\n      var request = {\n        method: Web3Method_1.Web3Method.switchEthereumChain,\n        params: {\n          chainId: chainId\n        }\n      };\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n      var cancel = function cancel() {\n        _this11.publishWeb3RequestCanceledEvent(id);\n        _this11.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n          id: id,\n          response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n        }));\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n      if (!this.ui.inlineSwitchEthereumChain()) {\n        hideSnackbarItem = this.ui.showConnecting({\n          isUnlinkedErrorState: this.isUnlinkedErrorState,\n          onCancel: cancel,\n          onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n        });\n      }\n\n      var promise = new Promise(function (resolve, reject) {\n        _this11.relayEventManager.callbacks.set(id, function (response) {\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n          if (response.errorMessage && response.errorCode) {\n            return reject(eth_rpc_errors_1.ethErrors.provider.custom({\n              code: response.errorCode,\n              message: \"Unrecognized chain ID. Try adding the chain using addEthereumChain first.\"\n            }));\n          } else if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n          resolve(response);\n        });\n        var _cancel = function _cancel(errorCode) {\n          if (errorCode) {\n            _this11.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n              id: id,\n              response: (0, Web3Response_1.ErrorResponse)(Web3Method_1.Web3Method.switchEthereumChain, \"unsupported chainId\", errorCode)\n            }));\n          } else {\n            _this11.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n              id: id,\n              response: (0, Web3Response_1.SwitchEthereumChainResponse)({\n                isApproved: false,\n                rpcUrl: \"\"\n              })\n            }));\n          }\n        };\n        var approve = function approve(rpcUrl) {\n          _this11.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.SwitchEthereumChainResponse)({\n              isApproved: true,\n              rpcUrl: rpcUrl\n            })\n          }));\n        };\n        _this11.ui.switchEthereumChain({\n          onCancel: _cancel,\n          onApprove: approve,\n          chainId: request.params.chainId\n        });\n        if (!_this11.ui.inlineSwitchEthereumChain() && !_this11.ui.isStandalone()) {\n          _this11.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        promise: promise,\n        cancel: cancel\n      };\n    }\n  }, {\n    key: \"getSessionIdHash\",\n    value: function getSessionIdHash() {\n      return Session_1.Session.hash(this._session.id);\n    }\n  }, {\n    key: \"sendRequestStandalone\",\n    value: function sendRequestStandalone(id, request) {\n      var _this12 = this;\n      var _cancel = function _cancel() {\n        _this12.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n          id: id,\n          response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n        }));\n      };\n      var onSuccess = function onSuccess(response) {\n        _this12.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n          id: id,\n          response: response\n        }));\n      };\n      switch (request.method) {\n        case Web3Method_1.Web3Method.signEthereumMessage:\n          this.ui.signEthereumMessage({\n            request: request,\n            onSuccess: onSuccess,\n            onCancel: _cancel\n          });\n          break;\n        case Web3Method_1.Web3Method.signEthereumTransaction:\n          this.ui.signEthereumTransaction({\n            request: request,\n            onSuccess: onSuccess,\n            onCancel: _cancel\n          });\n          break;\n        case Web3Method_1.Web3Method.submitEthereumTransaction:\n          this.ui.submitEthereumTransaction({\n            request: request,\n            onSuccess: onSuccess,\n            onCancel: _cancel\n          });\n          break;\n        case Web3Method_1.Web3Method.ethereumAddressFromSignedMessage:\n          this.ui.ethereumAddressFromSignedMessage({\n            request: request,\n            onSuccess: onSuccess\n          });\n          break;\n        default:\n          _cancel();\n          break;\n      }\n    }\n  }]);\n  return WalletLinkRelay;\n}(WalletLinkRelayAbstract_1.WalletLinkRelayAbstract);\nWalletLinkRelay.accountRequestCallbackIds = new Set();\n__decorate([bind_decorator_1.default], WalletLinkRelay.prototype, \"resetAndReload\", null);\n__decorate([bind_decorator_1.default], WalletLinkRelay.prototype, \"handleIncomingEvent\", null);\nexports.WalletLinkRelay = WalletLinkRelay;","map":{"version":3,"names":["_slicedToArray","require","_classCallCheck","_createClass","_inherits","_createSuper","__createBinding","Object","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","d","Reflect","decorate","i","__importStar","mod","__esModule","result","prototype","hasOwnProperty","call","__importDefault","exports","WalletLinkRelay","bind_decorator_1","eth_rpc_errors_1","rxjs_1","operators_1","WalletLinkAnalytics_1","WalletLinkConnection_1","init_1","util_1","aes256gcm","Session_1","WalletLinkRelayAbstract_1","Web3Method_1","Web3RequestCanceledMessage_1","Web3RequestMessage_1","Web3Response_1","Web3ResponseMessage_1","_WalletLinkRelayAbstr","_super","options","_this","accountsCallback","chainCallback","appName","appLogoUrl","subscriptions","Subscription","walletLinkUrl","storage","_session","Session","load","save","relayEventManager","walletLinkAnalytics","WalletLinkAnalytics","connection","WalletLinkConnection","id","add","incomingEvent$","pipe","filter","event","subscribe","next","handleIncomingEvent","linked$","skip","tap","linked","_a","isLinked","cachedAddresses","getItem","LOCAL_STORAGE_ADDRESSES_KEY","session","isUnlinkedErrorState","addresses","split","wasConnectedViaStandalone","sessionIdHash","getSessionIdHash","sendEvent","EVENTS","UNLINKED_ERROR_STATE","origin","location","sessionConfig$","metadata","__destroyed","alreadyDestroyed","isDestroyed","METADATA_DESTROYED","resetAndReload","WalletUsername","mergeMap","decrypt","secret","walletUsername","setItem","WALLET_USER_NAME_KEY","error","GENERAL_ERROR","message","AppVersion","appVersion","APP_VERSION_KEY","ChainId","JsonRpcUrl","zip","distinctUntilChanged","_ref","_ref2","chainId","jsonRpcUrl","EthereumAddress","selectedAddress","accountRequestCallbackIds","size","Array","from","values","forEach","Web3ResponseMessage","response","RequestEthereumAccountsResponse","invokeCallback","assign","clear","ui","walletLinkUIConstructor","version","darkMode","connected$","connect","attachUI","attach","_this2","setSessionMetadata","timeout","catchError","_","of","_b","_c","unsubscribe","err","SESSION_STATE_CHANGE","method","sessionMetadataChange","destroy","storedSession","SKIPPED_CLEARING_SESSION","storedSessionIdHash","hash","reloadUI","FAILURE","concat","setAppInfo","getStorageItem","setStorageItem","signEthereumMessage","address","addPrefix","typedDataJson","sendRequest","Web3Method","params","hexStringFromBuffer","ethereumAddressFromSignedMessage","signature","signEthereumTransaction","fromAddress","toAddress","weiValue","bigIntStringFromBN","data","nonce","gasPriceInWei","maxFeePerGas","maxPriorityFeePerGas","gasLimit","shouldSubmit","signAndSubmitEthereumTransaction","submitEthereumTransaction","signedTransaction","scanQRCode","regExp","genericRequest","action","generic","sendGenericMessage","request","_this3","hideSnackbarItem","randomBytesHex","cancel","publishWeb3RequestCanceledEvent","handleWeb3ResponseMessage","ErrorResponse","promise","Promise","resolve","reject","isStandalone","showConnecting","onCancel","onResetConnection","callbacks","set","errorMessage","Error","sendRequestStandalone","publishWeb3RequestEvent","setConnectDisabled","disabled","setAccountsCallback","setChainCallback","_this4","Web3RequestMessage","WEB3_REQUEST","eventId","isSessionMismatched","toString","publishEvent","WEB3_REQUEST_PUBLISHED","Web3RequestCanceledMessage","callWebhook","_this5","Observable","subscriber","encrypt","JSON","stringify","then","encrypted","complete","_this6","map","parse","json","isWeb3ResponseMessage","_this7","WEB3_RESPONSE","isRequestEthereumAccountsResponse","callback","delete","requestEthereumAccounts","_this8","hideRequestEthereumAccounts","userAgent","window","navigator","test","href","encodeURIComponent","inlineAccountsResponse","onAccounts","accounts","watchAsset","type","symbol","decimals","image","_this9","inlineWatchAsset","_cancel","WatchAssetReponse","approve","onApprove","addEthereumChain","rpcUrls","iconUrls","blockExplorerUrls","chainName","nativeCurrency","_this10","inlineAddEthereumChain","AddEthereumChainResponse","isApproved","rpcUrl","switchEthereumChain","_this11","inlineSwitchEthereumChain","errorCode","ethErrors","provider","custom","code","SwitchEthereumChainResponse","_this12","onSuccess","WalletLinkRelayAbstract","Set","default"],"sources":["E:/testprojects/CoolSwap-interface/node_modules/walletlink/dist/relay/WalletLinkRelay.js"],"sourcesContent":["\"use strict\";\n// Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WalletLinkRelay = void 0;\nconst bind_decorator_1 = __importDefault(require(\"bind-decorator\"));\nconst eth_rpc_errors_1 = require(\"eth-rpc-errors\");\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nconst WalletLinkAnalytics_1 = require(\"../connection/WalletLinkAnalytics\");\nconst WalletLinkConnection_1 = require(\"../connection/WalletLinkConnection\");\nconst init_1 = require(\"../init\");\nconst util_1 = require(\"../util\");\nconst aes256gcm = __importStar(require(\"./aes256gcm\"));\nconst Session_1 = require(\"./Session\");\nconst WalletLinkRelayAbstract_1 = require(\"./WalletLinkRelayAbstract\");\nconst Web3Method_1 = require(\"./Web3Method\");\nconst Web3RequestCanceledMessage_1 = require(\"./Web3RequestCanceledMessage\");\nconst Web3RequestMessage_1 = require(\"./Web3RequestMessage\");\nconst Web3Response_1 = require(\"./Web3Response\");\nconst Web3ResponseMessage_1 = require(\"./Web3ResponseMessage\");\nclass WalletLinkRelay extends WalletLinkRelayAbstract_1.WalletLinkRelayAbstract {\n    constructor(options) {\n        super();\n        this.accountsCallback = null;\n        this.chainCallback = null;\n        this.appName = \"\";\n        this.appLogoUrl = null;\n        this.subscriptions = new rxjs_1.Subscription();\n        this.walletLinkUrl = options.walletLinkUrl;\n        this.storage = options.storage;\n        this._session =\n            Session_1.Session.load(options.storage) || new Session_1.Session(options.storage).save();\n        this.relayEventManager = options.relayEventManager;\n        this.walletLinkAnalytics = options.walletLinkAnalytics\n            ? options.walletLinkAnalytics\n            : new WalletLinkAnalytics_1.WalletLinkAnalytics();\n        this.connection = new WalletLinkConnection_1.WalletLinkConnection(this._session.id, this._session.key, this.walletLinkUrl, this.walletLinkAnalytics);\n        this.subscriptions.add(this.connection.incomingEvent$\n            .pipe((0, operators_1.filter)(m => m.event === \"Web3Response\"))\n            .subscribe({ next: this.handleIncomingEvent }) // eslint-disable-line @typescript-eslint/unbound-method\n        );\n        this.subscriptions.add(this.connection.linked$\n            .pipe((0, operators_1.skip)(1), (0, operators_1.tap)((linked) => {\n            var _a;\n            this.isLinked = linked;\n            const cachedAddresses = this.storage.getItem(WalletLinkRelayAbstract_1.LOCAL_STORAGE_ADDRESSES_KEY);\n            if (linked) {\n                // Only set linked session variable one way\n                this.session.linked = linked;\n            }\n            this.isUnlinkedErrorState = false;\n            if (cachedAddresses) {\n                const addresses = cachedAddresses.split(\" \");\n                const wasConnectedViaStandalone = this.storage.getItem(\"IsStandaloneSigning\") === \"true\";\n                if (addresses[0] !== \"\" &&\n                    !linked &&\n                    this.session.linked &&\n                    !wasConnectedViaStandalone) {\n                    this.isUnlinkedErrorState = true;\n                    const sessionIdHash = this.getSessionIdHash();\n                    (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.UNLINKED_ERROR_STATE, { sessionIdHash, origin: location.origin });\n                }\n            }\n        }))\n            .subscribe());\n        // if session is marked destroyed, reset and reload\n        this.subscriptions.add(this.connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => !!c.metadata && c.metadata.__destroyed === \"1\"))\n            .subscribe(() => {\n            var _a;\n            const alreadyDestroyed = this.connection.isDestroyed;\n            (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.METADATA_DESTROYED, {\n                alreadyDestroyed,\n                sessionIdHash: this.getSessionIdHash(),\n                origin: location.origin\n            });\n            return this.resetAndReload();\n        }));\n        this.subscriptions.add(this.connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata && c.metadata.WalletUsername !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => aes256gcm.decrypt(c.metadata.WalletUsername, this._session.secret)))\n            .subscribe({\n            next: walletUsername => {\n                this.storage.setItem(WalletLinkRelayAbstract_1.WALLET_USER_NAME_KEY, walletUsername);\n            },\n            error: () => {\n                var _a;\n                (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"username\"\n                });\n            }\n        }));\n        this.subscriptions.add(this.connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata && c.metadata.AppVersion !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => aes256gcm.decrypt(c.metadata.AppVersion, this._session.secret)))\n            .subscribe({\n            next: appVersion => {\n                this.storage.setItem(WalletLinkRelayAbstract_1.APP_VERSION_KEY, appVersion);\n            },\n            error: () => {\n                var _a;\n                (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"appversion\"\n                });\n            }\n        }));\n        this.subscriptions.add(this.connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata &&\n            c.metadata.ChainId !== undefined &&\n            c.metadata.JsonRpcUrl !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => (0, rxjs_1.zip)(aes256gcm.decrypt(c.metadata.ChainId, this._session.secret), aes256gcm.decrypt(c.metadata.JsonRpcUrl, this._session.secret))))\n            .pipe((0, operators_1.distinctUntilChanged)())\n            .subscribe({\n            next: ([chainId, jsonRpcUrl]) => {\n                if (this.chainCallback) {\n                    this.chainCallback(chainId, jsonRpcUrl);\n                }\n            },\n            error: () => {\n                var _a;\n                (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"chainId|jsonRpcUrl\"\n                });\n            }\n        }));\n        this.subscriptions.add(this.connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata && c.metadata.EthereumAddress !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => aes256gcm.decrypt(c.metadata.EthereumAddress, this._session.secret)))\n            .subscribe({\n            next: selectedAddress => {\n                if (this.accountsCallback) {\n                    this.accountsCallback([selectedAddress]);\n                }\n                if (WalletLinkRelay.accountRequestCallbackIds.size > 0) {\n                    // We get the ethereum address from the metadata.  If for whatever\n                    // reason we don't get a response via an explicit web3 message\n                    // we can still fulfill the eip1102 request.\n                    Array.from(WalletLinkRelay.accountRequestCallbackIds.values()).forEach(id => {\n                        const message = (0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                            id,\n                            response: (0, Web3Response_1.RequestEthereumAccountsResponse)([\n                                selectedAddress\n                            ])\n                        });\n                        this.invokeCallback(Object.assign(Object.assign({}, message), { id }));\n                    });\n                    WalletLinkRelay.accountRequestCallbackIds.clear();\n                }\n            },\n            error: () => {\n                var _a;\n                (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"selectedAddress\"\n                });\n            }\n        }));\n        this.ui = options.walletLinkUIConstructor({\n            walletLinkUrl: options.walletLinkUrl,\n            version: options.version,\n            darkMode: options.darkMode,\n            session: this._session,\n            connected$: this.connection.connected$\n        });\n        this.connection.connect();\n    }\n    attachUI() {\n        this.ui.attach();\n    }\n    resetAndReload() {\n        this.connection\n            .setSessionMetadata(\"__destroyed\", \"1\")\n            .pipe((0, operators_1.timeout)(1000), (0, operators_1.catchError)(_ => (0, rxjs_1.of)(null)))\n            .subscribe(_ => {\n            var _a, _b, _c;\n            try {\n                this.subscriptions.unsubscribe();\n            }\n            catch (err) {\n                (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error unsubscribing\"\n                });\n            }\n            (_b = this.walletLinkAnalytics) === null || _b === void 0 ? void 0 : _b.sendEvent(init_1.EVENTS.SESSION_STATE_CHANGE, {\n                method: \"relay::resetAndReload\",\n                sessionMetadataChange: \"__destroyed, 1\",\n                sessionIdHash: this.getSessionIdHash(),\n                origin: location.origin\n            });\n            this.connection.destroy();\n            /**\n             * Only clear storage if the session id we have in memory matches the one on disk\n             * Otherwise, in the case where we have 2 tabs, another tab might have cleared\n             * storage already.  In that case if we clear storage again, the user will be in\n             * a state where the first tab allows the user to connect but the session that\n             * was used isn't persisted.  This leaves the user in a state where they aren't\n             * connected to the mobile app.\n             */\n            const storedSession = Session_1.Session.load(this.storage);\n            if ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) === this._session.id) {\n                this.storage.clear();\n            }\n            else if (storedSession) {\n                (_c = this.walletLinkAnalytics) === null || _c === void 0 ? void 0 : _c.sendEvent(init_1.EVENTS.SKIPPED_CLEARING_SESSION, {\n                    sessionIdHash: this.getSessionIdHash(),\n                    storedSessionIdHash: Session_1.Session.hash(storedSession.id),\n                    origin: location.origin\n                });\n            }\n            this.ui.reloadUI();\n        }, (err) => {\n            var _a;\n            (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.FAILURE, {\n                method: \"relay::resetAndReload\",\n                message: `failed to reset and reload with ${err}`,\n                sessionIdHash: this.getSessionIdHash()\n            });\n        });\n    }\n    setAppInfo(appName, appLogoUrl) {\n        this.appName = appName;\n        this.appLogoUrl = appLogoUrl;\n    }\n    getStorageItem(key) {\n        return this.storage.getItem(key);\n    }\n    get session() {\n        return this._session;\n    }\n    setStorageItem(key, value) {\n        this.storage.setItem(key, value);\n    }\n    signEthereumMessage(message, address, addPrefix, typedDataJson) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumMessage,\n            params: {\n                message: (0, util_1.hexStringFromBuffer)(message, true),\n                address,\n                addPrefix,\n                typedDataJson: typedDataJson || null\n            }\n        });\n    }\n    ethereumAddressFromSignedMessage(message, signature, addPrefix) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.ethereumAddressFromSignedMessage,\n            params: {\n                message: (0, util_1.hexStringFromBuffer)(message, true),\n                signature: (0, util_1.hexStringFromBuffer)(signature, true),\n                addPrefix\n            }\n        });\n    }\n    signEthereumTransaction(params) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumTransaction,\n            params: {\n                fromAddress: params.fromAddress,\n                toAddress: params.toAddress,\n                weiValue: (0, util_1.bigIntStringFromBN)(params.weiValue),\n                data: (0, util_1.hexStringFromBuffer)(params.data, true),\n                nonce: params.nonce,\n                gasPriceInWei: params.gasPriceInWei\n                    ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei)\n                    : null,\n                maxFeePerGas: params.gasPriceInWei\n                    ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei)\n                    : null,\n                maxPriorityFeePerGas: params.gasPriceInWei\n                    ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei)\n                    : null,\n                gasLimit: params.gasLimit ? (0, util_1.bigIntStringFromBN)(params.gasLimit) : null,\n                chainId: params.chainId,\n                shouldSubmit: false\n            }\n        });\n    }\n    signAndSubmitEthereumTransaction(params) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumTransaction,\n            params: {\n                fromAddress: params.fromAddress,\n                toAddress: params.toAddress,\n                weiValue: (0, util_1.bigIntStringFromBN)(params.weiValue),\n                data: (0, util_1.hexStringFromBuffer)(params.data, true),\n                nonce: params.nonce,\n                gasPriceInWei: params.gasPriceInWei\n                    ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei)\n                    : null,\n                maxFeePerGas: params.maxFeePerGas\n                    ? (0, util_1.bigIntStringFromBN)(params.maxFeePerGas)\n                    : null,\n                maxPriorityFeePerGas: params.maxPriorityFeePerGas\n                    ? (0, util_1.bigIntStringFromBN)(params.maxPriorityFeePerGas)\n                    : null,\n                gasLimit: params.gasLimit ? (0, util_1.bigIntStringFromBN)(params.gasLimit) : null,\n                chainId: params.chainId,\n                shouldSubmit: true\n            }\n        });\n    }\n    submitEthereumTransaction(signedTransaction, chainId) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.submitEthereumTransaction,\n            params: {\n                signedTransaction: (0, util_1.hexStringFromBuffer)(signedTransaction, true),\n                chainId\n            }\n        });\n    }\n    scanQRCode(regExp) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.scanQRCode,\n            params: { regExp }\n        });\n    }\n    genericRequest(data, action) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.generic,\n            params: {\n                action,\n                data\n            }\n        });\n    }\n    sendGenericMessage(request) {\n        return this.sendRequest(request);\n    }\n    sendRequest(request) {\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = () => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id,\n                response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n            }));\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        const promise = new Promise((resolve, reject) => {\n            if (!this.ui.isStandalone()) {\n                hideSnackbarItem = this.ui.showConnecting({\n                    isUnlinkedErrorState: this.isUnlinkedErrorState,\n                    onCancel: cancel,\n                    onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n                });\n            }\n            this.relayEventManager.callbacks.set(id, response => {\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            if (this.ui.isStandalone()) {\n                this.sendRequestStandalone(id, request);\n            }\n            else {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { promise, cancel };\n    }\n    setConnectDisabled(disabled) {\n        this.ui.setConnectDisabled(disabled);\n    }\n    setAccountsCallback(accountsCallback) {\n        this.accountsCallback = accountsCallback;\n    }\n    setChainCallback(chainCallback) {\n        this.chainCallback = chainCallback;\n    }\n    publishWeb3RequestEvent(id, request) {\n        var _a;\n        const message = (0, Web3RequestMessage_1.Web3RequestMessage)({ id, request });\n        const storedSession = Session_1.Session.load(this.storage);\n        (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.WEB3_REQUEST, {\n            eventId: message.id,\n            method: `relay::${message.request.method}`,\n            sessionIdHash: this.getSessionIdHash(),\n            storedSessionIdHash: storedSession ? Session_1.Session.hash(storedSession.id) : \"\",\n            isSessionMismatched: ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) !== this._session.id).toString(),\n            origin: location.origin\n        });\n        this.subscriptions.add(this.publishEvent(\"Web3Request\", message, true).subscribe({\n            next: _ => {\n                var _a;\n                (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.WEB3_REQUEST_PUBLISHED, {\n                    eventId: message.id,\n                    method: `relay::${message.request.method}`,\n                    sessionIdHash: this.getSessionIdHash(),\n                    storedSessionIdHash: storedSession\n                        ? Session_1.Session.hash(storedSession.id)\n                        : \"\",\n                    isSessionMismatched: ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) !== this._session.id).toString(),\n                    origin: location.origin\n                });\n            },\n            error: err => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id: message.id,\n                    response: {\n                        method: message.request.method,\n                        errorMessage: err.message\n                    }\n                }));\n            }\n        }));\n    }\n    publishWeb3RequestCanceledEvent(id) {\n        const message = (0, Web3RequestCanceledMessage_1.Web3RequestCanceledMessage)(id);\n        this.subscriptions.add(this.publishEvent(\"Web3RequestCanceled\", message, false).subscribe());\n    }\n    publishEvent(event, message, callWebhook) {\n        const secret = this.session.secret;\n        return new rxjs_1.Observable(subscriber => {\n            void aes256gcm\n                .encrypt(JSON.stringify(Object.assign(Object.assign({}, message), { origin: location.origin })), secret)\n                .then((encrypted) => {\n                subscriber.next(encrypted);\n                subscriber.complete();\n            });\n        }).pipe((0, operators_1.mergeMap)((encrypted) => {\n            return this.connection.publishEvent(event, encrypted, callWebhook);\n        }));\n    }\n    handleIncomingEvent(event) {\n        try {\n            this.subscriptions.add(aes256gcm\n                .decrypt(event.data, this.session.secret)\n                .pipe((0, operators_1.map)(c => JSON.parse(c)))\n                .subscribe({\n                next: json => {\n                    const message = (0, Web3ResponseMessage_1.isWeb3ResponseMessage)(json) ? json : null;\n                    if (!message) {\n                        return;\n                    }\n                    this.handleWeb3ResponseMessage(message);\n                },\n                error: () => {\n                    var _a;\n                    (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.GENERAL_ERROR, {\n                        message: \"Had error decrypting\",\n                        value: \"incomingEvent\"\n                    });\n                }\n            }));\n        }\n        catch (_a) {\n            return;\n        }\n    }\n    handleWeb3ResponseMessage(message) {\n        var _a;\n        const { response } = message;\n        (_a = this.walletLinkAnalytics) === null || _a === void 0 ? void 0 : _a.sendEvent(init_1.EVENTS.WEB3_RESPONSE, {\n            eventId: message.id,\n            method: `relay::${response.method}`,\n            sessionIdHash: this.getSessionIdHash(),\n            origin: location.origin\n        });\n        if ((0, Web3Response_1.isRequestEthereumAccountsResponse)(response)) {\n            Array.from(WalletLinkRelay.accountRequestCallbackIds.values()).forEach(id => this.invokeCallback(Object.assign(Object.assign({}, message), { id })));\n            WalletLinkRelay.accountRequestCallbackIds.clear();\n            return;\n        }\n        this.invokeCallback(message);\n    }\n    invokeCallback(message) {\n        const callback = this.relayEventManager.callbacks.get(message.id);\n        if (callback) {\n            callback(message.response);\n            this.relayEventManager.callbacks.delete(message.id);\n        }\n    }\n    requestEthereumAccounts() {\n        let request = {\n            method: Web3Method_1.Web3Method.requestEthereumAccounts,\n            params: {\n                appName: this.appName,\n                appLogoUrl: this.appLogoUrl || null\n            }\n        };\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = () => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id,\n                response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n            }));\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        const promise = new Promise((resolve, reject) => {\n            var _a;\n            this.relayEventManager.callbacks.set(id, response => {\n                this.ui.hideRequestEthereumAccounts();\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const userAgent = ((_a = window === null || window === void 0 ? void 0 : window.navigator) === null || _a === void 0 ? void 0 : _a.userAgent) || null;\n            if (userAgent &&\n                /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)) {\n                window.location.href = `https://go.cb-w.com/xoXnYwQimhb?cb_url=${encodeURIComponent(window.location.href)}`;\n                return;\n            }\n            if (this.ui.inlineAccountsResponse()) {\n                const onAccounts = (accounts) => {\n                    this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                        id,\n                        response: (0, Web3Response_1.RequestEthereumAccountsResponse)(accounts)\n                    }));\n                };\n                this.ui.requestEthereumAccounts({\n                    onCancel: cancel,\n                    onAccounts\n                });\n            }\n            else {\n                this.ui.requestEthereumAccounts({\n                    onCancel: cancel\n                });\n            }\n            WalletLinkRelay.accountRequestCallbackIds.add(id);\n            if (!this.ui.inlineAccountsResponse() && !this.ui.isStandalone()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { promise, cancel };\n    }\n    watchAsset(type, address, symbol, decimals, image) {\n        const request = {\n            method: Web3Method_1.Web3Method.watchAsset,\n            params: {\n                type,\n                options: {\n                    address,\n                    symbol,\n                    decimals,\n                    image\n                }\n            }\n        };\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = () => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id,\n                response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n            }));\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        if (!this.ui.inlineWatchAsset()) {\n            hideSnackbarItem = this.ui.showConnecting({\n                isUnlinkedErrorState: this.isUnlinkedErrorState,\n                onCancel: cancel,\n                onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n            });\n        }\n        const promise = new Promise((resolve, reject) => {\n            this.relayEventManager.callbacks.set(id, response => {\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const _cancel = () => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.WatchAssetReponse)(false)\n                }));\n            };\n            const approve = () => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.WatchAssetReponse)(true)\n                }));\n            };\n            if (this.ui.inlineWatchAsset()) {\n                this.ui.watchAsset({\n                    onApprove: approve,\n                    onCancel: _cancel,\n                    type,\n                    address,\n                    symbol,\n                    decimals,\n                    image\n                });\n            }\n            if (!this.ui.inlineWatchAsset() && !this.ui.isStandalone()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { cancel, promise };\n    }\n    addEthereumChain(chainId, rpcUrls, iconUrls, blockExplorerUrls, chainName, nativeCurrency) {\n        let request = {\n            method: Web3Method_1.Web3Method.addEthereumChain,\n            params: {\n                chainId,\n                rpcUrls,\n                blockExplorerUrls,\n                chainName,\n                iconUrls,\n                nativeCurrency\n            }\n        };\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = () => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id,\n                response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n            }));\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        if (!this.ui.inlineAddEthereumChain(chainId)) {\n            hideSnackbarItem = this.ui.showConnecting({\n                isUnlinkedErrorState: this.isUnlinkedErrorState,\n                onCancel: cancel,\n                onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n            });\n        }\n        const promise = new Promise((resolve, reject) => {\n            this.relayEventManager.callbacks.set(id, response => {\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const _cancel = () => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.AddEthereumChainResponse)({\n                        isApproved: false,\n                        rpcUrl: \"\"\n                    })\n                }));\n            };\n            const approve = (rpcUrl) => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.AddEthereumChainResponse)({ isApproved: true, rpcUrl })\n                }));\n            };\n            if (this.ui.inlineAddEthereumChain(chainId)) {\n                this.ui.addEthereumChain({\n                    onCancel: _cancel,\n                    onApprove: approve,\n                    chainId: request.params.chainId,\n                    rpcUrls: request.params.rpcUrls,\n                    blockExplorerUrls: request.params\n                        .blockExplorerUrls,\n                    chainName: request.params.chainName,\n                    iconUrls: request.params.iconUrls,\n                    nativeCurrency: request.params\n                        .nativeCurrency\n                });\n            }\n            if (!this.ui.inlineAddEthereumChain(chainId) && !this.ui.isStandalone()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { promise, cancel };\n    }\n    switchEthereumChain(chainId) {\n        let request = {\n            method: Web3Method_1.Web3Method.switchEthereumChain,\n            params: {\n                chainId\n            }\n        };\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = () => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id,\n                response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n            }));\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        if (!this.ui.inlineSwitchEthereumChain()) {\n            hideSnackbarItem = this.ui.showConnecting({\n                isUnlinkedErrorState: this.isUnlinkedErrorState,\n                onCancel: cancel,\n                onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n            });\n        }\n        const promise = new Promise((resolve, reject) => {\n            this.relayEventManager.callbacks.set(id, response => {\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage && response.errorCode) {\n                    return reject(eth_rpc_errors_1.ethErrors.provider.custom({\n                        code: response.errorCode,\n                        message: `Unrecognized chain ID. Try adding the chain using addEthereumChain first.`\n                    }));\n                }\n                else if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const _cancel = (errorCode) => {\n                if (errorCode) {\n                    this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                        id,\n                        response: (0, Web3Response_1.ErrorResponse)(Web3Method_1.Web3Method.switchEthereumChain, \"unsupported chainId\", errorCode)\n                    }));\n                }\n                else {\n                    this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                        id,\n                        response: (0, Web3Response_1.SwitchEthereumChainResponse)({\n                            isApproved: false,\n                            rpcUrl: \"\"\n                        })\n                    }));\n                }\n            };\n            const approve = (rpcUrl) => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.SwitchEthereumChainResponse)({\n                        isApproved: true,\n                        rpcUrl\n                    })\n                }));\n            };\n            this.ui.switchEthereumChain({\n                onCancel: _cancel,\n                onApprove: approve,\n                chainId: request.params.chainId\n            });\n            if (!this.ui.inlineSwitchEthereumChain() && !this.ui.isStandalone()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { promise, cancel };\n    }\n    getSessionIdHash() {\n        return Session_1.Session.hash(this._session.id);\n    }\n    sendRequestStandalone(id, request) {\n        const _cancel = () => {\n            this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id,\n                response: (0, Web3Response_1.ErrorResponse)(request.method, \"User rejected request\")\n            }));\n        };\n        const onSuccess = (response) => {\n            this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id,\n                response\n            }));\n        };\n        switch (request.method) {\n            case Web3Method_1.Web3Method.signEthereumMessage:\n                this.ui.signEthereumMessage({\n                    request,\n                    onSuccess,\n                    onCancel: _cancel\n                });\n                break;\n            case Web3Method_1.Web3Method.signEthereumTransaction:\n                this.ui.signEthereumTransaction({\n                    request,\n                    onSuccess,\n                    onCancel: _cancel\n                });\n                break;\n            case Web3Method_1.Web3Method.submitEthereumTransaction:\n                this.ui.submitEthereumTransaction({\n                    request,\n                    onSuccess,\n                    onCancel: _cancel\n                });\n                break;\n            case Web3Method_1.Web3Method.ethereumAddressFromSignedMessage:\n                this.ui.ethereumAddressFromSignedMessage({\n                    request,\n                    onSuccess\n                });\n                break;\n            default:\n                _cancel();\n                break;\n        }\n    }\n}\nWalletLinkRelay.accountRequestCallbackIds = new Set();\n__decorate([\n    bind_decorator_1.default\n], WalletLinkRelay.prototype, \"resetAndReload\", null);\n__decorate([\n    bind_decorator_1.default\n], WalletLinkRelay.prototype, \"handleIncomingEvent\", null);\nexports.WalletLinkRelay = WalletLinkRelay;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}